2023-06-11 16:44:39.907 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38230 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:44:39.919 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:44:39.924 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38418 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:44:39.928 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:44:39.947 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38420 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:44:42.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38486 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:44:44.799 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:44:44.800 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:44:45.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:44:45.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38574 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:44:45.866 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:44:45.908 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38576 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:44:48.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38664 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:44:49.909 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:44:49.929 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:44:49.930 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:44:49.932 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:44:49.933 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:44:49.935 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:44:49.937 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:44:49.938 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:44:50.037 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:44:50.038 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:44:50.039 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:44:50.040 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:44:50.042 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:44:50.056 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:44:50.057 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:44:50.059 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:44:50.060 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:44:50.099 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:44:50.123 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:44:51.168 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:44:51.186 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:44:51.187 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:44:51.189 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:44:51.190 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5ab98>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5ab98>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5ab98>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5ab98>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a688>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a688>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a688>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a688>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a688>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54019b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54019b8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54019b8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539f340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fe80>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a5a898>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a5a898>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:44:51.252 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38572 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:44:51.854 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38762 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:44:51.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:44:51.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:44:51.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38764 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:44:54.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38830 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:44:56.154 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:44:56.155 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:44:57.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:44:57.860 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38914 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:44:57.866 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:44:57.912 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38916 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:00.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39012 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:01.254 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:01.269 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:01.271 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:01.272 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:45:01.273 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:45:01.275 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:45:01.276 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:45:01.278 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:45:01.386 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:45:01.387 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:45:01.389 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:45:01.390 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:01.393 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:01.406 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:45:01.407 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:45:01.409 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:45:01.410 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:45:01.450 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:45:01.474 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:45:02.523 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:02.546 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:02.548 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:02.549 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:45:02.551 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5817b80>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5817b80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5817b80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5817b80>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c2e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c2e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c2e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c2e0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c2e0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5340538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5340538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5340538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5340c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340a48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340a48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340a48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5340808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53405c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53405c8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53405c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53402b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb549c5f8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb549c5f8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:45:02.619 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38882 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:45:03.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:03.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:03.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39106 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:03.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39108 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:06.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39174 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:07.504 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:45:07.505 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:45:09.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:09.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39272 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:09.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:09.900 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39274 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:12.598 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:12.614 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:12.615 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:12.617 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:45:12.618 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:45:12.619 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:45:12.620 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:45:12.622 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:45:12.747 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:45:12.750 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:45:12.751 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:45:12.752 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:12.755 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:12.767 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:45:12.768 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:45:12.770 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:45:12.771 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:45:12.812 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:45:12.835 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:45:13.907 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:13.928 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:13.929 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:13.930 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:45:13.932 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4acc358>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4acc358>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4acc358>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4acc358>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa15b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa15b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa15b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa15b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa15b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389028>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389028>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389610>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4aa1940>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4aa1940>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:45:13.991 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39214 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:45:13.999 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39370 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:15.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:15.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39438 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:15.871 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:15.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39440 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:18.883 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:45:18.885 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:45:19.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39532 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:21.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:21.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39606 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:21.868 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:21.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39608 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:23.978 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:24.001 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:24.003 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:24.004 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:45:24.006 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:45:24.008 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:45:24.009 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:45:24.011 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:45:24.114 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:45:24.115 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:45:24.116 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:45:24.117 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:24.120 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:24.133 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:45:24.135 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:45:24.136 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:45:24.137 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:45:24.176 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:45:24.201 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:45:25.256 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:25.275 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:25.277 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:25.278 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:45:25.279 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74cb8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a74cb8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a74cb8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74cb8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa14d8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa14d8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa14d8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa14d8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa14d8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5314388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5314388>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5314388>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fda8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fda8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fda8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4aa1700>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4aa1700>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:45:25.349 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39530 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:45:25.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39732 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:27.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:27.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39780 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:27.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:27.897 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39782 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:30.233 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:45:30.235 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:45:31.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39886 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:33.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:33.858 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39948 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:33.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:33.877 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39950 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:35.324 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:35.336 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:35.337 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:35.339 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:45:35.340 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:45:35.342 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:45:35.343 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:45:35.344 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:45:35.449 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:45:35.450 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:45:35.451 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:45:35.452 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:35.459 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:35.474 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:45:35.476 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:45:35.478 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:45:35.480 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:45:35.537 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:45:35.562 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:45:36.604 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:36.621 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:36.623 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:36.625 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:45:36.627 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5305f40>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5305f40>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5305f40>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5305f40>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a238>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a238>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a238>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a238>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a238>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389a48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389a48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bb0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bb0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bb0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676e8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a5afe8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a5afe8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:45:36.687 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39854 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:45:36.759 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40322 - "GET / HTTP/1.1" 200
2023-06-11 16:45:36.797 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40324 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:45:36.808 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40326 - "GET /docs HTTP/1.1" 200
2023-06-11 16:45:36.825 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40328 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:45:36.835 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40330 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:45:36.845 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40332 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:45:36.860 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40334 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:45:36.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40336 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:45:37.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40410 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:39.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:39.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:39.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40456 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:39.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40458 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:41.594 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:45:41.595 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:45:43.877 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40582 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:45.870 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:45.877 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40646 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:45.882 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:45.908 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40650 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:46.690 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:46.709 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:46.710 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:46.712 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:45:46.714 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:45:46.715 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:45:46.717 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:45:46.718 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:45:46.840 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:45:46.840 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:45:46.841 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:45:46.843 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:46.846 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:46.867 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:45:46.868 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:45:46.870 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:45:46.871 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:45:46.919 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:45:46.943 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:45:47.988 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:48.008 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:48.009 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:48.011 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:45:48.012 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb533cb08>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb533cb08>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb533cb08>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb533cb08>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533c460>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533c460>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533c460>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533c460>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533c460>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53898e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53898e0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53898e0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389850>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389850>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389850>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67d18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389808>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb533c490>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb533c490>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:45:48.080 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40520 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:45:49.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40764 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:51.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:51.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40814 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:51.871 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:51.896 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40816 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:52.973 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:45:52.974 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:45:55.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40922 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:45:57.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:57.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40992 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:45:57.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:57.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40994 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:45:58.059 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:58.078 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:58.079 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:58.081 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:45:58.084 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:45:58.085 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:45:58.088 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:45:58.090 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:45:58.196 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:45:58.196 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:45:58.197 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:45:58.198 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:45:58.201 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:45:58.215 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:45:58.215 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:45:58.217 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:45:58.218 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:45:58.255 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:45:58.281 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:45:59.322 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:45:59.336 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:45:59.337 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:45:59.338 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:45:59.339 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5852ac0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5852ac0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5852ac0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5852ac0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74f28>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74f28>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74f28>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74f28>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74f28>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fcd0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fcd0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fcd0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f2b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f2b0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f2b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f2b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f2b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a74a60>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a74a60>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:45:59.387 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40870 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:46:01.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41096 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:03.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:03.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41146 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:03.866 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:03.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41148 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:04.317 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:46:04.318 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:46:07.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41276 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:09.409 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:09.420 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:09.420 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:09.422 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:46:09.422 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:46:09.424 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:46:09.425 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:46:09.426 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:46:09.514 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:46:09.515 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:46:09.516 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:46:09.517 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:09.521 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:09.539 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:46:09.540 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:46:09.542 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:46:09.543 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:46:09.596 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:46:09.630 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:46:10.693 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:10.701 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41348 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:10.704 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:10.724 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:10.741 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:10.742 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:10.744 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:46:10.745 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa1d18>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4aa1d18>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4aa1d18>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa1d18>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9d18>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9d18>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9d18>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9d18>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9d18>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67268>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67268>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bf8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bf8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bf8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bf8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bf8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67460>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54c9c88>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54c9c88>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:46:10.793 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41186 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:46:10.798 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41350 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:13.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41450 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:15.679 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:46:15.680 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:46:15.854 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41498 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:16.867 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:16.876 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:16.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41524 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:19.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41624 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:20.781 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:20.797 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:20.800 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:20.802 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:46:20.803 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:46:20.805 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:46:20.806 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:46:20.807 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:46:20.923 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:46:20.924 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:46:20.925 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:46:20.927 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:20.930 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:20.943 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:46:20.944 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:46:20.945 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:46:20.947 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:46:20.987 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:46:21.011 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:46:22.068 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41686 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:22.085 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:22.106 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:22.108 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:22.110 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:46:22.111 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54520b8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54520b8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54520b8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54520b8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dec8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dec8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dec8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dec8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dec8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a671d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a671d8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a671d8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a679b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67a00>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67340>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67070>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb534d1c0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb534d1c0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:46:22.185 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41522 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:46:22.843 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:22.845 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:22.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41712 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:25.871 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41788 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:27.044 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:46:27.045 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:46:27.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41842 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:28.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:28.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:28.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41880 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:31.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41978 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:32.136 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:32.154 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:32.155 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:32.158 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:46:32.160 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:46:32.162 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:46:32.163 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:46:32.165 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:46:32.281 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:46:32.282 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:46:32.283 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:46:32.285 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:32.288 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:32.303 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:46:32.304 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:46:32.307 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:46:32.308 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:46:32.347 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:46:32.371 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:46:33.476 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:33.496 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:33.498 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:33.500 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:46:33.502 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa1700>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4aa1700>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4aa1700>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa1700>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a310>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a310>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a310>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a310>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a310>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67658>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67658>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67730>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67730>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67730>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548a7c0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548a7c0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:46:33.574 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41844 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:46:33.856 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42054 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:34.871 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:34.875 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:34.908 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42078 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:37.857 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42264 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:38.461 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:46:38.463 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:46:39.855 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42336 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:40.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:40.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:40.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42368 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:43.550 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:43.574 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:43.575 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:43.577 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:46:43.578 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:46:43.580 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:46:43.582 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:46:43.583 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:46:43.687 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:46:43.688 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:46:43.693 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:46:43.694 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:43.698 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:43.711 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:46:43.711 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:46:43.713 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:46:43.714 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:46:43.753 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:46:43.777 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:46:44.840 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:44.867 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:44.869 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:44.870 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:46:44.872 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa16d0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4aa16d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4aa16d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa16d0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a760>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a760>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a760>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a760>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a760>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389340>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389340>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5305a78>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5305a78>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:46:44.938 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42304 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:46:44.944 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42464 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:45.846 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42520 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:46.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:46.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:46.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42548 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:49.812 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:46:49.815 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:46:50.936 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42648 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:51.860 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42686 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:52.839 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:52.843 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:52.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42722 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:46:54.926 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:54.946 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:54.948 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:54.950 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:46:54.953 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:46:54.956 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:46:54.958 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:46:54.960 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:46:55.059 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:46:55.060 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:46:55.061 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:46:55.062 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:55.065 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:55.079 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:46:55.080 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:46:55.083 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:46:55.084 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:46:55.123 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:46:55.148 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:46:56.196 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:46:56.219 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:46:56.221 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:46:56.223 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:46:56.224 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74b08>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a74b08>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a74b08>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74b08>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a100>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a100>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a100>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a100>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a100>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a677c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a677c0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a677c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a677c0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a677c0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bb0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67fa0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb533c400>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb533c400>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:46:56.294 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42646 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:46:56.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42842 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:46:57.858 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42868 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:46:58.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:46:58.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:46:58.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42888 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:01.180 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:47:01.180 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:47:02.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43004 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:03.852 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43040 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:04.843 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:04.846 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:04.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43072 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:06.265 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:06.277 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:06.278 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:06.279 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:47:06.281 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:47:06.282 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:47:06.284 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:47:06.285 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:47:06.381 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:47:06.383 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:47:06.384 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:47:06.388 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:06.391 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:06.404 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:47:06.405 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:47:06.406 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:47:06.407 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:47:06.447 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:47:06.472 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:47:07.524 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:07.544 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:07.545 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:07.547 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:47:07.549 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5852a78>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5852a78>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5852a78>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5852a78>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a3b8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a3b8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a3b8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a3b8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a3b8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539f2b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539f2b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539f2b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539f340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548a2f8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548a2f8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:47:07.611 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42964 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:47:08.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43190 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:09.850 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43222 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:10.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:10.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:10.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43238 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:12.503 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:47:12.504 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:47:14.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43362 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:15.854 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43396 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:16.846 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:16.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:16.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43422 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:17.590 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:17.601 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:17.602 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:17.603 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:47:17.604 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:47:17.605 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:47:17.606 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:47:17.608 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:47:17.742 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:47:17.743 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:47:17.744 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:47:17.745 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:17.748 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:17.761 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:47:17.761 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:47:17.763 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:47:17.764 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:47:17.802 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:47:17.827 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:47:18.875 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:18.900 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:18.901 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:18.903 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:47:18.905 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5852898>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5852898>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5852898>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5852898>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852988>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852988>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852988>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852988>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852988>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541fdf0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541fdf0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fec8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fec8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fec8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5852a30>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5852a30>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:47:18.978 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43298 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:47:20.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43526 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:21.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43558 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:22.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:22.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:22.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43574 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:23.864 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:47:23.867 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:47:26.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43690 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:27.855 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43730 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:28.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:28.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:28.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43762 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:28.973 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:28.989 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:28.991 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:28.992 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:47:28.994 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:47:28.996 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:47:28.998 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:47:28.999 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:47:29.110 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:47:29.111 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:47:29.113 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:47:29.114 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:29.117 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:29.132 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:47:29.133 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:47:29.135 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:47:29.135 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:47:29.174 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:47:29.200 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:47:30.239 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:30.254 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:30.255 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:30.256 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:47:30.258 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb58520a0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb58520a0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb58520a0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb58520a0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441370>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441370>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441370>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441370>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441370>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53bad60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53bad60>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53bad60>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53bac40>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bac88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bac88>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bac88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bac88>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bac88>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53bacd0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53babb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53babb0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53babb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5441e68>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5441e68>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:47:30.304 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43632 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:47:32.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43866 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:33.854 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43896 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:34.883 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:34.887 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:34.915 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43928 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:35.231 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:47:35.232 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:47:37.126 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44280 - "GET / HTTP/1.1" 200
2023-06-11 16:47:37.167 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44286 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:47:37.182 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44288 - "GET /docs HTTP/1.1" 200
2023-06-11 16:47:37.196 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44290 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:47:37.211 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44292 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:47:37.230 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44298 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:47:37.241 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44300 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:47:37.253 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44302 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:47:38.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44392 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:39.855 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44424 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:40.318 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:40.336 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:40.339 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:40.340 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:47:40.342 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:47:40.343 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:47:40.345 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:47:40.347 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:47:40.463 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:47:40.464 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:47:40.465 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:47:40.466 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:40.469 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:40.482 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:47:40.483 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:47:40.486 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:47:40.487 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:47:40.527 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:47:40.553 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:47:41.602 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:41.613 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:41.626 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:41.652 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:41.654 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:41.655 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:47:41.656 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb534d130>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb534d130>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb534d130>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb534d130>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dc40>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dc40>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dc40>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dc40>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dc40>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539ff10>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539ff10>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539f340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2b0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb534de08>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb534de08>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:47:41.699 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44094 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:47:41.708 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44460 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:44.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44556 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:45.856 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44584 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:46.588 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:47:46.589 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:47:46.868 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:46.874 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:46.915 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44618 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:50.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44740 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:51.682 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:51.706 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:51.707 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:51.708 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:47:51.709 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:47:51.710 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:47:51.711 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:47:51.711 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:47:51.796 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:47:51.797 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:47:51.798 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:47:51.801 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:51.805 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:51.819 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:47:51.821 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:47:51.824 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:47:51.827 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:47:51.871 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:47:51.897 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:47:52.947 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:52.958 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44776 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:52.963 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:52.976 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:47:52.997 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:47:53.000 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:47:53.004 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:47:53.009 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb534da18>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb534da18>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb534da18>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb534da18>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817778>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817778>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817778>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817778>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817778>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67148>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67148>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67028>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67028>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67028>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54520b8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54520b8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:47:53.049 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44616 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:47:53.060 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44802 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:47:56.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44894 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:47:57.932 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:47:57.934 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:47:58.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44946 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:47:58.881 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:47:58.887 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:47:58.933 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44950 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:02.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45076 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:03.019 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:03.031 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:03.034 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:03.034 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:48:03.036 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:48:03.037 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:48:03.038 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:48:03.039 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:48:03.118 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:48:03.119 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:48:03.120 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:48:03.121 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:03.126 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:03.144 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:48:03.145 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:48:03.146 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:48:03.147 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:48:03.198 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:48:03.242 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:48:04.302 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:04.320 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:04.322 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:04.323 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:48:04.325 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb548a2f8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb548a2f8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb548a2f8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb548a2f8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a460>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a460>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a460>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a460>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a5a460>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539f2b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539f2b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539f2b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539f340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f388>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a5a208>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a5a208>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:48:04.388 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44948 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:48:04.849 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:04.852 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45140 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:04.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:04.871 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45142 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:08.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45232 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:09.289 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:48:09.292 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:48:10.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:10.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45304 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:10.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:10.906 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45306 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:14.384 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:14.402 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:14.405 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:14.406 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:48:14.408 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:48:14.410 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:48:14.411 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:48:14.413 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:48:14.537 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:48:14.537 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:48:14.539 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:48:14.540 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:14.543 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:14.557 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:48:14.557 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:48:14.560 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:48:14.560 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:48:14.600 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:48:14.625 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:48:15.684 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:15.711 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:15.714 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:15.715 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:48:15.716 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852aa8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852aa8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852aa8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852aa8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852aa8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5314388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5314388>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5314388>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54a9bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54230b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53143d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a74e50>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a74e50>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:48:15.778 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45268 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:48:15.784 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45426 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:16.855 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45480 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:16.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:16.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:16.878 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45482 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:20.660 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:48:20.661 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:48:20.913 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45574 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:22.860 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45642 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:22.868 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:22.872 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:22.906 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45644 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:25.763 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:25.780 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:25.782 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:25.784 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:48:25.785 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:48:25.787 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:48:25.789 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:48:25.791 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:48:25.913 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:48:25.914 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:48:25.915 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:48:25.916 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:25.919 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:25.933 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:48:25.934 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:48:25.936 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:48:25.937 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:48:25.981 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:48:26.008 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:48:27.068 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:27.100 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:27.102 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:27.102 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:48:27.104 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb534d940>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb534d940>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb534d940>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb534d940>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74d30>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74d30>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74d30>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74d30>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74d30>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547f2b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547f2b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547f2b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67ec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fbf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a745f8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a745f8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:48:27.150 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45572 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:48:27.157 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45758 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:28.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:28.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45814 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:28.866 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:28.901 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45816 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:32.043 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:48:32.044 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:48:32.901 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45920 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:34.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45998 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:34.894 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:34.897 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:34.930 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46000 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:37.131 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:37.153 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:37.156 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:37.157 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:48:37.158 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:48:37.160 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:48:37.162 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:48:37.164 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:48:37.291 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:48:37.292 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:48:37.293 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:48:37.295 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:37.298 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:37.310 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:48:37.311 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:48:37.313 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:48:37.314 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:48:37.354 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:48:37.381 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:48:38.434 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:38.455 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:38.458 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:38.460 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:48:38.462 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74988>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a74988>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a74988>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74988>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441208>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441208>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441208>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441208>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441208>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67f58>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67f58>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a674a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a670b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a670b8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a670b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4acc478>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4acc478>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:48:38.511 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45918 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:48:38.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46124 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:40.844 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:40.850 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46174 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:40.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:40.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46176 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:43.417 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:48:43.418 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:48:44.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46284 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:46.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:46.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46350 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:46.868 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:46.894 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46352 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:48.514 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:48.525 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:48.526 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:48.527 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:48:48.528 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:48:48.528 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:48:48.529 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:48:48.530 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:48:48.611 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:48:48.612 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:48:48.613 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:48:48.614 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:48.617 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:48.638 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:48:48.641 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:48:48.643 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:48:48.645 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:48:48.712 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:48:48.741 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:48:49.782 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:49.795 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:49.796 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:49.797 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:48:49.798 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb533cb50>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb533cb50>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb533cb50>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb533cb50>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852748>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852748>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852748>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852748>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852748>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547f1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547f1d8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547f1d8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547fd60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fcd0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fcd0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fcd0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5852eb0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5852eb0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:48:49.838 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46252 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:48:50.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46464 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:52.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:52.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46510 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:52.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:52.897 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46512 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:54.774 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:48:54.774 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:48:56.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46618 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:48:58.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:48:58.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46682 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:48:58.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:48:58.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46684 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:48:59.874 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:48:59.892 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:48:59.893 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:48:59.896 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:48:59.900 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:48:59.901 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:48:59.902 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:48:59.904 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:48:59.992 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:48:59.992 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:48:59.995 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:48:59.996 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:00.000 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:00.016 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:49:00.018 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:49:00.021 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:49:00.022 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:49:00.062 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:49:00.086 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:49:01.133 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:01.159 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:01.161 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:01.162 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:49:01.164 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54c9af0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54c9af0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54c9af0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54c9af0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852148>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852148>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852148>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852148>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852148>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54019b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54019b8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54019b8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389d18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541ff58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541ff58>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541ff58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5401898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5852100>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5852100>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:49:01.219 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46596 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:49:02.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46788 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:04.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:04.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46838 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:04.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:04.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46840 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:06.119 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:49:06.121 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:49:08.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46956 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:10.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:10.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47018 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:10.873 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:10.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47020 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:11.210 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:11.227 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:11.228 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:11.230 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:49:11.231 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:49:11.232 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:49:11.234 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:49:11.235 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:49:11.327 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:49:11.328 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:49:11.329 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:49:11.330 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:11.333 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:11.345 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:49:11.346 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:49:11.347 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:49:11.348 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:49:11.386 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:49:11.412 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:49:12.461 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:12.480 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:12.481 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:12.482 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:49:12.483 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5509df0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5509df0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5509df0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5509df0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389970>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389970>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53892b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389c40>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb533ce98>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb533ce98>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:49:12.545 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46890 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:49:14.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47132 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:16.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:16.866 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47168 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:16.873 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:16.904 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47170 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:17.446 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:49:17.448 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:49:20.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47294 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:22.538 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:22.560 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:22.562 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:22.563 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:49:22.565 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:49:22.566 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:49:22.568 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:49:22.569 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:49:22.683 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:49:22.683 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:49:22.684 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:49:22.685 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:22.688 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:22.702 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:49:22.703 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:49:22.705 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:49:22.706 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:49:22.745 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:49:22.771 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:49:23.827 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:23.834 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:23.841 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47360 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:23.860 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:23.889 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:23.892 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:23.893 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:49:23.895 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54c91d8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54c91d8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54c91d8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54c91d8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305f88>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305f88>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305f88>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305f88>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305f88>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fda8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fda8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fda8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389340>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f2f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4aa1c28>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4aa1c28>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:49:23.956 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47210 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:49:23.962 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47362 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:26.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47468 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:28.809 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:49:28.812 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:49:29.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47552 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:29.880 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:29.893 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:29.960 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47562 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:32.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47646 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:33.914 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:33.931 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:33.934 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:33.935 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:49:33.938 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:49:33.940 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:49:33.941 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:49:33.943 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:49:34.045 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:49:34.045 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:49:34.046 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:49:34.047 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:34.050 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:34.064 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:49:34.065 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:49:34.066 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:49:34.067 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:49:34.109 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:49:34.134 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:49:35.181 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:35.205 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:35.207 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:35.208 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:49:35.209 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5452b08>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5452b08>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5452b08>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5452b08>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb552f718>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb552f718>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb552f718>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb552f718>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb552f718>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67c40>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67c40>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67c40>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67d60>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67d60>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67d60>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a676e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb534d778>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb534d778>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:49:35.271 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47560 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:49:35.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47874 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:35.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:35.873 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:35.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47880 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:36.781 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48044 - "GET / HTTP/1.1" 200
2023-06-11 16:49:36.813 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48046 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:49:36.831 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48048 - "GET /docs HTTP/1.1" 200
2023-06-11 16:49:36.844 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48054 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:49:36.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48060 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:49:36.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48062 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:49:36.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48064 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:49:36.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48070 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:49:38.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48158 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:40.171 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:49:40.173 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:49:41.845 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48248 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:41.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:41.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:41.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48256 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:44.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48340 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:45.270 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:45.298 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:45.300 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:45.302 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:49:45.304 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:49:45.306 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:49:45.308 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:49:45.310 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:49:45.421 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:49:45.423 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:49:45.425 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:49:45.426 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:45.429 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:45.442 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:49:45.443 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:49:45.446 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:49:45.446 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:49:45.488 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:49:45.516 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:49:46.571 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:46.593 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:46.595 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:46.596 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:49:46.598 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5817190>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5817190>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5817190>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5817190>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852bf8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852bf8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852bf8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852bf8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852bf8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67f58>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67f58>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5852da8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5852da8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:49:46.668 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48214 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:49:47.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:47.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48432 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:47.874 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:47.908 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48440 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:50.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48500 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:51.553 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:49:51.554 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:49:53.874 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:53.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48596 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:53.882 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:53.912 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48602 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:49:56.618 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:56.630 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:56.631 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:56.633 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:49:56.634 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:49:56.636 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:49:56.637 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:49:56.638 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:49:56.731 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:49:56.732 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:49:56.733 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:49:56.734 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:56.740 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:56.753 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:49:56.753 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:49:56.755 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:49:56.756 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:49:56.795 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:49:56.821 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:49:57.887 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:49:57.909 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:49:57.910 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:49:57.911 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:49:57.912 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb534de38>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb534de38>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb534de38>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb534de38>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c358>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c358>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c358>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c358>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c358>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67190>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67190>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a670b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67df0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a742f8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a742f8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:49:57.957 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48536 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:49:57.962 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48688 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:49:59.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:49:59.855 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48768 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:49:59.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:49:59.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48772 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:02.859 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:50:02.860 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:50:03.907 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48868 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:05.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:05.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48942 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:05.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:05.900 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48944 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:07.974 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:07.996 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:07.998 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:08.000 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:50:08.002 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:50:08.003 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:50:08.005 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:50:08.006 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:50:08.125 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:50:08.126 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:50:08.127 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:50:08.128 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:08.131 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:08.145 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:50:08.146 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:50:08.148 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:50:08.149 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:50:08.193 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:50:08.218 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:50:09.279 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:09.305 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:09.307 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:09.309 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:50:09.311 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa14d8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4aa14d8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4aa14d8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa14d8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817e08>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817e08>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817e08>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817e08>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817e08>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541fec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541fec8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541fec8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541ff10>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541ff10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb58170a0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb58170a0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:50:09.365 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48866 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:50:09.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49068 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:11.848 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:11.853 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49118 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:11.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:11.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49120 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:14.255 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:50:14.256 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:50:15.866 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49228 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:17.876 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:17.878 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49294 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:17.884 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:17.900 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49298 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:19.349 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:19.365 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:19.367 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:19.370 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:50:19.371 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:50:19.373 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:50:19.374 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:50:19.375 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:50:19.487 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:50:19.488 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:50:19.489 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:50:19.489 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:19.493 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:19.508 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:50:19.508 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:50:19.510 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:50:19.511 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:50:19.548 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:50:19.574 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:50:20.625 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:20.648 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:20.650 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:20.652 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:50:20.655 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb58521a8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb58521a8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb58521a8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb58521a8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c90b8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c90b8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c90b8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c90b8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c90b8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fe80>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb547fe80>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f1d8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f1d8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f1d8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547fd60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fec8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb547f220>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5509fb8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5509fb8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:50:20.736 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49192 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:50:21.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49404 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:23.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:23.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49456 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:23.872 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:23.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49458 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:25.610 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:50:25.613 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:50:27.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49574 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:29.868 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:29.873 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:29.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49640 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:29.925 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49644 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:30.718 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:30.737 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:30.738 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:30.739 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:50:30.741 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:50:30.742 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:50:30.743 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:50:30.745 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:50:30.858 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:50:30.858 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:50:30.860 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:50:30.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:30.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:30.876 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:50:30.877 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:50:30.878 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:50:30.879 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:50:30.916 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:50:30.942 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:50:31.989 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:32.008 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:32.009 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:32.011 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:50:32.012 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54523d0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54523d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54523d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54523d0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aee0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aee0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aee0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aee0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aee0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67970>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67970>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba0b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba0b8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba0b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548ae20>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548ae20>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:50:32.067 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49512 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:50:33.894 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49750 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:35.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:35.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:35.866 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49934 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:35.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49936 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:36.856 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50106 - "GET / HTTP/1.1" 200
2023-06-11 16:50:36.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50108 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:50:36.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50110 - "GET /docs HTTP/1.1" 200
2023-06-11 16:50:36.917 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50112 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:50:36.930 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50114 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:50:36.940 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50120 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:50:36.951 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50122 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:50:36.963 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50124 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:50:36.976 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:50:36.977 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:50:39.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50260 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:41.878 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:41.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50322 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:41.885 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:41.922 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50326 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:42.072 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:42.082 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:42.083 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:42.084 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:50:42.089 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:50:42.090 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:50:42.091 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:50:42.092 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:50:42.175 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:50:42.176 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:50:42.178 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:50:42.178 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:42.182 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:42.195 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:50:42.196 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:50:42.198 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:50:42.199 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:50:42.243 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:50:42.271 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:50:43.322 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:43.344 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:43.347 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:43.348 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:50:43.351 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74388>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a74388>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a74388>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74388>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54416d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54416d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54416d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54416d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54416d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba148>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba148>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba9b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba9b8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba9b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba9b8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba9b8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba070>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba808>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53baa00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54411a8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54411a8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:50:43.431 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50202 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:50:45.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50432 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:47.867 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:47.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50476 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:47.878 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:47.919 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50480 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:48.305 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:50:48.306 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:50:51.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50608 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:53.397 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:53.418 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:53.420 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:53.422 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:50:53.424 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:50:53.425 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:50:53.427 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:50:53.428 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:50:53.539 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:50:53.540 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:50:53.541 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:50:53.543 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:53.547 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:53.560 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:50:53.560 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:50:53.562 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:50:53.563 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:50:53.601 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:50:53.627 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:50:54.675 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:50:54.684 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:50:54.689 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50682 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:50:54.709 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:50:54.733 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:50:54.736 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:50:54.737 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:50:54.739 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb548aa30>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb548aa30>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb548aa30>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb548aa30>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cf10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cf10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cf10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cf10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cf10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba418>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba418>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53baec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba4a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba4a8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba4a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba4a8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba4a8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba2b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a74eb0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a74eb0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:50:54.798 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50516 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:50:54.809 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50686 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:50:57.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50780 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:50:59.663 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:50:59.666 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:50:59.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50846 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:00.866 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:00.883 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:00.931 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50862 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:03.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50952 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:04.776 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:04.792 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:04.793 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:04.795 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:51:04.797 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:51:04.800 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:51:04.801 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:51:04.803 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:51:04.925 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:51:04.926 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:51:04.927 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:51:04.927 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:04.930 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:04.944 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:51:04.945 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:51:04.947 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:51:04.948 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:51:04.989 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:51:05.015 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:51:06.058 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51020 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:06.067 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:06.080 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:06.082 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:06.083 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:51:06.084 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54c9790>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54c9790>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54c9790>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54c9790>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18f10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18f10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18f10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18f10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18f10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9a90>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9a90>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9b20>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9b20>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9b20>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9b68>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9bb0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9a48>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a184f0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a184f0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:51:06.135 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:50860 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:51:06.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:06.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:06.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51056 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:09.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51116 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:11.055 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:51:11.059 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:51:11.877 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51174 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:12.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:12.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:12.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51216 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:15.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51304 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:16.166 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:16.186 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:16.189 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:16.190 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:51:16.192 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:51:16.195 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:51:16.197 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:51:16.198 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:51:16.309 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:51:16.310 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:51:16.312 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:51:16.313 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:16.316 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:16.328 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:51:16.329 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:51:16.332 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:51:16.332 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:51:16.373 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:51:16.399 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:51:17.450 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:17.467 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:17.468 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:17.470 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:51:17.471 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a18a30>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a18a30>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a18a30>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a18a30>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5844c58>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5844c58>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5844c58>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5844c58>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5844c58>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54110b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54110b8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54110b8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411100>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411100>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411100>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54114a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54114a8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54114a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54111d8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5844aa8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5844aa8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:51:17.539 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51176 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:51:17.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51376 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:18.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:18.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:18.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51400 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:21.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51454 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:22.437 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:51:22.439 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:51:23.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51532 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:24.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:24.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:24.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51564 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:27.534 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:27.552 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:27.554 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:27.555 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:51:27.556 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:51:27.558 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:51:27.559 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:51:27.560 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:51:27.671 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:51:27.672 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:51:27.674 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:51:27.674 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:27.678 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:27.691 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:51:27.692 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:51:27.694 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:51:27.695 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:51:27.736 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:51:27.762 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:51:28.827 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:28.848 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:28.849 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:28.850 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:51:28.851 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3be0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ab3be0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ab3be0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3be0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3f70>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3f70>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3f70>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3f70>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3f70>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67df0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67df0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67c88>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a678e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54add18>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54add18>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:51:28.894 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51494 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:51:28.900 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51652 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:29.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51712 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:30.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:30.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:30.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51742 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:33.798 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:51:33.799 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:51:34.920 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51838 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:35.854 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51872 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:36.850 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:36.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:36.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51910 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:38.912 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:38.933 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:38.934 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:38.936 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:51:38.937 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:51:38.939 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:51:38.940 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:51:38.942 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:51:39.054 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:51:39.054 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:51:39.056 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:51:39.057 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:39.060 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:39.073 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:51:39.074 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:51:39.077 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:51:39.078 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:51:39.116 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:51:39.143 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:51:40.194 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:40.213 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:40.215 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:40.217 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:51:40.218 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18aa8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18aa8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18aa8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18aa8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18aa8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba580>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba580>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba580>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba6a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba028>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4aa1df0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4aa1df0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:51:40.299 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:51836 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:51:40.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52028 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:41.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52064 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:42.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:42.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:42.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52084 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:45.178 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:51:45.180 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:51:46.896 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52190 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:47.866 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52228 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:48.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:48.863 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:48.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52270 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:50.263 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:50.278 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:50.279 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:50.281 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:51:50.283 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:51:50.285 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:51:50.287 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:51:50.288 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:51:50.400 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:51:50.400 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:51:50.401 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:51:50.402 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:50.406 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:50.419 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:51:50.421 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:51:50.423 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:51:50.424 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:51:50.465 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:51:50.492 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:51:51.543 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:51:51.563 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:51:51.564 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:51:51.566 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:51:51.568 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a880>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5a880>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5a880>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a880>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74208>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74208>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74208>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74208>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74208>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9d18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9d18>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9d18>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9808>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9808>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9808>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f95c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9bf8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9bf8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9bf8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9bb0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a74178>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a74178>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:51:51.638 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52154 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:51:52.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52374 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:53.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52408 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:51:54.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:51:54.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:51:54.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52438 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:51:56.531 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:51:56.534 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:51:58.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52546 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:51:59.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52588 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:00.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:00.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:00.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52620 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:01.628 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:01.646 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:01.648 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:01.650 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:52:01.652 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:52:01.653 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:52:01.656 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:52:01.658 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:52:01.762 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:52:01.763 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:52:01.764 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:52:01.766 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:01.769 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:01.781 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:52:01.782 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:52:01.784 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:52:01.785 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:52:01.822 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:52:01.851 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:52:02.903 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:02.930 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:02.932 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:02.934 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:52:02.936 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa1748>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4aa1748>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4aa1748>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4aa1748>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a298>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a298>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a298>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a298>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a298>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53baa48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53baa48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53baa48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba1d8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba1d8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba1d8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bad18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bad18>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bad18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548a0e8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548a0e8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:52:03.011 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52488 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:52:04.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52716 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:05.844 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52746 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:06.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:06.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:06.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52774 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:07.886 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:52:07.887 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:52:10.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52880 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:11.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52920 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:12.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:12.863 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:12.898 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52954 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:12.963 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:12.975 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:12.976 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:12.977 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:52:12.978 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:52:12.979 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:52:12.981 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:52:12.982 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:52:13.065 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:52:13.066 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:52:13.067 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:52:13.069 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:13.073 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:13.086 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:52:13.087 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:52:13.089 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:52:13.090 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:52:13.127 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:52:13.153 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:52:14.206 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:14.227 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:14.228 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:14.230 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:52:14.231 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5508>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ac5508>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ac5508>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5508>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18688>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18688>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18688>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18688>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18688>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9d60>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9d60>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9a00>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9850>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9850>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9850>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9cd0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9340>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a188e0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a188e0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:52:14.285 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:52824 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:52:16.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53054 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:17.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53090 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:18.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:18.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:18.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53110 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:19.193 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:52:19.194 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:52:22.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53220 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:23.852 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53266 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:24.288 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:24.299 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:24.300 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:24.301 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:52:24.302 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:52:24.304 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:52:24.305 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:52:24.307 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:52:24.392 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:52:24.393 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:52:24.395 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:52:24.395 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:24.398 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:24.412 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:52:24.413 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:52:24.415 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:52:24.416 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:52:24.455 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:52:24.481 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:52:25.535 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:25.542 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:25.556 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:25.579 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:25.581 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:25.584 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:52:25.586 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad088>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54ad088>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54ad088>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad088>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb08>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb08>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb08>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb08>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb08>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9f10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9f10>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9f10>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9fa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9e38>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9e38>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9e38>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9028>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f90b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54ad160>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54ad160>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:52:25.650 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53138 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:52:25.659 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53300 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:28.902 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53394 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:29.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53424 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:30.517 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:52:30.518 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:52:30.871 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:30.876 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:30.922 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53468 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:34.920 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53586 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:35.596 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:35.608 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:35.609 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:35.610 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:52:35.611 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:52:35.612 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:52:35.614 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:52:35.614 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:52:35.720 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:52:35.722 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:52:35.724 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:52:35.725 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:35.727 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:35.740 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:52:35.741 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:52:35.743 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:52:35.744 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:52:35.783 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:52:35.811 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:52:36.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:36.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53756 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:36.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:36.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53934 - "GET / HTTP/1.1" 200
2023-06-11 16:52:36.900 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53936 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:36.911 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:36.926 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:36.927 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:36.929 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:52:36.930 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5aa30>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5aa30>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5aa30>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5aa30>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5778>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5778>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5778>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5778>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5778>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a678e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67f58>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a670b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a670b8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a670b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67538>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ac55b0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ac55b0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:52:36.978 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53466 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:52:36.987 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53946 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:52:36.998 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53948 - "GET /docs HTTP/1.1" 200
2023-06-11 16:52:37.010 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53950 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:52:37.021 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53952 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:52:37.030 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53954 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:52:37.041 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53956 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:52:37.053 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:53958 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:52:40.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54090 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:41.850 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:52:41.852 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:52:42.866 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:42.876 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:42.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54150 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:42.952 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54152 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:46.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54280 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:46.996 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:47.017 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:47.018 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:47.020 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:52:47.021 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:52:47.023 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:52:47.024 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:52:47.026 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:52:47.159 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:52:47.162 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:52:47.163 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:52:47.168 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:47.172 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:47.201 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:52:47.202 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:52:47.205 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:52:47.206 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:52:47.252 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:52:47.277 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:52:48.326 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:48.342 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:48.343 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:48.345 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:52:48.348 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab37c0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ab37c0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ab37c0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab37c0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74e50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74e50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74e50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74e50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74e50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9070>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a740d0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a740d0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:52:48.418 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54154 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:52:48.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:48.860 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54354 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:48.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:48.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54356 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:52.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54430 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:52:53.315 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:52:53.316 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:52:54.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:54.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54514 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:52:54.871 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:54.902 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54516 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:52:58.414 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:58.440 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:58.442 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:58.443 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:52:58.444 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:52:58.446 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:52:58.447 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:52:58.449 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:52:58.544 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:52:58.545 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:52:58.546 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:52:58.547 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:52:58.549 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:52:58.563 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:52:58.564 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:52:58.565 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:52:58.566 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:52:58.603 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:52:58.629 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:52:59.695 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:52:59.724 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:52:59.725 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:52:59.727 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:52:59.728 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb534d088>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059a0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059a0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059a0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059a0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53059a0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb580c538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb580c538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb580c538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb580cf10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5423100>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54230b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fdf0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cc88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5852b38>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5852b38>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:52:59.802 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54478 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:52:59.808 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54626 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:00.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:00.879 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:00.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54688 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:00.914 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54690 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:04.671 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:53:04.673 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:53:05.914 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54804 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:06.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:06.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54850 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:06.866 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:06.921 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54854 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:09.773 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:09.792 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:09.794 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:09.795 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:53:09.797 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:53:09.800 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:53:09.802 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:53:09.803 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:53:09.905 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:53:09.905 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:53:09.906 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:53:09.907 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:09.911 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:09.924 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:53:09.925 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:53:09.926 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:53:09.928 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:53:09.968 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:53:09.994 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:53:11.047 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:11.069 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:11.070 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:11.072 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:53:11.073 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3ad8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ab3ad8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ab3ad8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3ad8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3058>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3058>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3058>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3058>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3058>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba4f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba190>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba190>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba190>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba8e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a672f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ab3da8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ab3da8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:53:11.146 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54802 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:53:11.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:54994 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:12.873 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:12.877 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:12.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55026 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:12.916 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55030 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:16.035 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:53:16.038 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:53:17.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55156 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:18.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:18.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:18.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55198 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:18.897 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55200 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:21.132 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:21.153 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:21.155 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:21.156 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:53:21.157 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:53:21.158 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:53:21.160 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:53:21.162 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:53:21.262 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:53:21.264 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:53:21.264 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:53:21.265 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:21.269 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:21.282 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:53:21.283 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:53:21.285 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:53:21.286 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:53:21.327 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:53:21.353 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:53:22.405 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:22.425 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:22.427 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:22.429 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:53:22.431 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a189a0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a189a0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a189a0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a189a0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dfb8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dfb8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dfb8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dfb8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb534dfb8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba268>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba268>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba460>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53bab68>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba7c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba7c0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba7c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53babf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb534dce8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb534dce8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:53:22.515 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55124 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:53:23.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55326 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:24.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:24.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55360 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:24.871 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:24.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55364 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:27.392 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:53:27.393 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:53:29.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55498 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:30.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55540 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:30.878 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:30.882 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:30.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55544 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:32.492 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:32.508 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:32.510 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:32.511 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:53:32.513 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:53:32.515 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:53:32.516 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:53:32.518 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:53:32.636 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:53:32.637 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:53:32.638 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:53:32.639 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:32.642 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:32.656 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:53:32.657 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:53:32.658 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:53:32.659 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:53:32.709 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:53:32.736 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:53:33.790 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:33.816 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:33.817 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:33.820 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:53:33.821 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a18190>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a18190>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a18190>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a18190>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18a30>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18a30>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18a30>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18a30>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18a30>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f99b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9730>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f92f8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a18e20>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a18e20>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:53:33.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55440 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:53:35.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55692 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:36.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:36.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55722 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:36.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:36.897 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55726 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:38.775 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:53:38.777 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:53:41.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55862 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:42.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:42.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55898 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:42.873 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:42.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55902 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:43.905 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:43.934 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:43.935 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:43.937 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:53:43.939 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:53:43.940 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:53:43.942 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:53:43.945 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:53:44.055 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:53:44.056 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:53:44.057 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:53:44.058 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:44.061 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:44.075 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:53:44.076 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:53:44.078 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:53:44.079 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:53:44.121 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:53:44.147 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:53:45.184 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:45.209 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:45.211 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:45.212 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:53:45.214 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5509fb8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5509fb8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5509fb8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5509fb8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3ca0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3ca0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3ca0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3ca0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3ca0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba970>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba970>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53bafa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baa48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baa48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baa48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baa48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baa48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bab68>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bab68>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bab68>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53badf0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ab3dc0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ab3dc0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:53:45.276 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:55802 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:53:47.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56024 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:48.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:48.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56058 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:48.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:48.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56064 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:50.188 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:53:50.189 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:53:53.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56214 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:53:54.879 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:54.884 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:54.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56254 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:53:54.933 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56258 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:53:55.285 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:55.297 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:55.298 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:55.299 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:53:55.300 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:53:55.300 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:53:55.301 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:53:55.302 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:53:55.384 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:53:55.384 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:53:55.385 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:53:55.386 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:53:55.389 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:53:55.402 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:53:55.403 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:53:55.404 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:53:55.405 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:53:55.456 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:53:55.483 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:53:56.534 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:53:56.552 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:53:56.554 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:53:56.555 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:53:56.556 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a8c8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa18c8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa18c8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa18c8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa18c8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4aa18c8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a670b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a670b8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a670b8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a678e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67928>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67df0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67f10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5452640>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5452640>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:53:56.610 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56120 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:53:59.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56378 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:00.850 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56412 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:00.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:00.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:00.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56418 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:01.520 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:54:01.521 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:54:05.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56556 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:06.620 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:06.638 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:06.640 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:06.641 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:54:06.643 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:54:06.645 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:54:06.646 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:54:06.647 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:54:06.760 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:54:06.761 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:54:06.762 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:54:06.763 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:06.766 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:06.778 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:54:06.779 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:54:06.781 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:54:06.781 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:54:06.821 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:54:06.853 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:54:07.909 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:07.919 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56594 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:07.921 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:07.935 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:07.961 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:07.963 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:07.964 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:54:07.965 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3880>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ab3880>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ab3880>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3880>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533cf28>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533cf28>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533cf28>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533cf28>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb533cf28>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67c88>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67c88>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe80>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb533c928>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb533c928>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:54:08.030 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56452 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:54:08.042 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56598 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:11.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56718 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:12.897 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:54:12.898 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:54:13.882 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:13.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56784 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:13.890 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:13.948 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56788 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:17.871 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56906 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:17.997 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:18.020 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:18.023 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:18.025 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:54:18.027 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:54:18.031 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:54:18.033 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:54:18.035 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:54:18.146 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:54:18.147 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:54:18.149 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:54:18.150 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:18.152 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:18.167 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:54:18.169 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:54:18.170 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:54:18.171 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:54:18.208 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:54:18.235 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:54:19.278 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:19.289 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:19.290 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:19.291 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:54:19.292 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a760>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5a760>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5a760>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a760>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc928>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc928>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc928>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc928>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc928>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bada8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bada8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bada8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bada8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bada8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53baf58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bae38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bae38>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bae38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53ba388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ab3df0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ab3df0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:54:19.336 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56786 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:54:19.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:19.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56986 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:19.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:19.896 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:56988 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:23.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57068 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:24.271 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:54:24.272 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:54:25.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57136 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:25.886 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:25.890 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:25.920 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57138 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:29.357 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:29.378 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:29.379 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:29.381 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:54:29.383 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:54:29.387 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:54:29.388 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:54:29.391 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:54:29.505 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:54:29.505 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:54:29.506 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:54:29.508 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:29.511 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:29.524 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:54:29.525 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:54:29.526 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:54:29.529 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:54:29.569 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:54:29.596 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:54:30.668 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:30.692 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:30.693 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:30.695 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:54:30.697 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a18ac0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a18ac0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a18ac0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a18ac0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a188f8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a188f8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a188f8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a188f8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a188f8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54a9bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54a9bb0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54a9bb0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba8e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baec8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baec8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53baec8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5314388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53143d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53143d0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53143d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a00>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54c98f8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54c98f8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:54:30.766 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57104 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:54:30.772 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57248 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:31.880 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:31.884 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:31.901 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57312 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:31.930 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57314 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:35.635 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:54:35.636 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:54:36.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57676 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:37.066 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57740 - "GET / HTTP/1.1" 200
2023-06-11 16:54:37.100 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57742 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:54:37.112 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57744 - "GET /docs HTTP/1.1" 200
2023-06-11 16:54:37.124 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57746 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:54:37.134 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57748 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:54:37.144 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57750 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:54:37.155 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57752 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:54:37.167 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57754 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:54:37.903 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:37.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57832 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:37.910 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:37.932 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57836 - "GET /v1.0/available_boards HTTP/1.0" 200
