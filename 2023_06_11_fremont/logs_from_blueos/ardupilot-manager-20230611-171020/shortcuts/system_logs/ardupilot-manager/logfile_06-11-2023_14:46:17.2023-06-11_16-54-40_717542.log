2023-06-11 16:54:40.715 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:40.732 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:40.734 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:40.736 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:54:40.737 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:54:40.740 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:54:40.741 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:54:40.743 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:54:40.853 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:54:40.854 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:54:40.855 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:54:40.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:40.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:40.872 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:54:40.873 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:54:40.875 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:54:40.876 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:54:40.914 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:54:40.941 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:54:41.995 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:42.013 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:42.014 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:42.016 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:54:42.017 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad6d0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54ad6d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54ad6d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad6d0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5538>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5538>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5538>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5538>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5538>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9e80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9e80>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9e80>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f96e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9d60>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9d60>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9d60>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f98e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f98e0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f98e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ac5ee0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ac5ee0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:54:42.089 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57674 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:54:42.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:57976 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:43.877 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58010 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:43.883 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:43.887 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:43.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58014 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:46.980 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:54:46.981 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:54:48.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58136 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:49.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:49.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58174 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:49.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:49.901 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58178 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:52.083 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:52.099 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:52.101 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:52.102 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:54:52.103 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:54:52.105 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:54:52.106 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:54:52.107 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:54:52.243 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:54:52.244 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:54:52.248 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:54:52.250 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:52.253 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:52.267 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:54:52.268 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:54:52.270 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:54:52.271 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:54:52.318 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:54:52.345 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:54:53.388 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:54:53.401 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:54:53.402 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:54:53.403 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:54:53.404 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a181a8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a181a8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a181a8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a181a8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18520>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18520>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18520>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18520>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18520>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb580c538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb580c538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb580c538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9ec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9070>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9070>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9070>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9070>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9070>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9340>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a185c8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a185c8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:54:53.448 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58100 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:54:54.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58318 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:54:55.878 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:54:55.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58358 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:54:55.891 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:54:55.926 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58362 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:54:58.386 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:54:58.388 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:55:00.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58498 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:01.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:01.871 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:01.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58536 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:01.912 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58540 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:03.482 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:03.493 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:03.494 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:03.495 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:55:03.496 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:55:03.497 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:55:03.498 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:55:03.498 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:55:03.577 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:55:03.577 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:55:03.579 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:55:03.580 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:03.582 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:03.595 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:55:03.596 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:55:03.598 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:55:03.599 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:55:03.642 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:55:03.669 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:55:04.720 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:04.739 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:04.740 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:04.742 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:55:04.743 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a718>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5a718>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5a718>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a718>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18da8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18da8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18da8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18da8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18da8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba460>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53ba460>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53ba1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba658>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53baf58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a18070>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a18070>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:55:04.792 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58432 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:55:06.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58674 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:07.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58704 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:07.880 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:07.884 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:07.916 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58708 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:09.711 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:55:09.712 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:55:12.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58840 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:13.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:13.876 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:13.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58878 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:13.917 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58882 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:14.819 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:14.837 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:14.838 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:14.840 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:55:14.841 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:55:14.843 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:55:14.844 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:55:14.845 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:55:14.969 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:55:14.971 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:55:14.972 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:55:14.973 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:14.976 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:14.989 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:55:14.990 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:55:14.991 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:55:14.992 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:55:15.030 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:55:15.057 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:55:16.111 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:16.132 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:16.134 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:16.135 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:55:16.137 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4acccd0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4acccd0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4acccd0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4acccd0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3958>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3958>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3958>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3958>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3958>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9658>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9658>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f94a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f94a8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f94a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9e80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ab3ac0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ab3ac0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:55:16.203 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:58782 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:55:18.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59010 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:19.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:19.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59044 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:19.872 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:19.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59048 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:21.096 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:55:21.097 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:55:24.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59182 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:25.887 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:25.890 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:25.906 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59220 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:25.933 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59224 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:26.191 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:26.202 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:26.203 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:26.204 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:55:26.205 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:55:26.206 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:55:26.207 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:55:26.208 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:55:26.286 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:55:26.287 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:55:26.289 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:55:26.290 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:26.293 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:26.306 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:55:26.306 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:55:26.308 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:55:26.309 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:55:26.350 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:55:26.376 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:55:27.435 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:27.461 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:27.463 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:27.464 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:55:27.466 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad538>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54ad538>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54ad538>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad538>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a185e0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a185e0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a185e0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a185e0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a185e0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67e80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67850>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67850>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67850>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53bae80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba418>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53ba418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a674f0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a181d8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a181d8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:55:27.520 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59098 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:55:30.871 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59348 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:31.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59378 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:31.879 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:31.883 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:31.915 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59382 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:32.419 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:55:32.420 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:55:36.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59538 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:37.494 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:37.516 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:37.517 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:37.519 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:55:37.520 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:55:37.522 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:55:37.523 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:55:37.524 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:55:37.614 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:55:37.614 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:55:37.615 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:55:37.616 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:37.619 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:37.631 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:55:37.632 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:55:37.633 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:55:37.634 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:55:37.672 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:55:37.698 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:55:38.756 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:38.766 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59580 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:38.766 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:38.782 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:38.802 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:38.805 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:38.807 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:55:38.809 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5df0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ac5df0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ac5df0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5df0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3e08>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3e08>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3e08>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3e08>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab3e08>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53bad18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53bad18>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53bad18>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54113d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411778>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411778>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411778>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54116a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411808>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67c88>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ab3e80>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ab3e80>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:55:38.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59414 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:55:38.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59584 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:42.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59702 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:43.736 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:55:43.737 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:55:43.850 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59758 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:44.850 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:44.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:44.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59784 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:48.837 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:48.855 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:48.856 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:48.858 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:55:48.859 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:55:48.861 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:55:48.862 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:55:48.863 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:55:48.961 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:55:48.962 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:55:48.963 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:55:48.963 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:48.967 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:48.979 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:55:48.980 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:55:48.981 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:55:48.982 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:55:49.023 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:55:49.050 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:55:50.106 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59930 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:50.119 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:55:50.132 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59908 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:50.138 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:55:50.139 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:55:50.140 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:55:50.141 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5718>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ac5718>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ac5718>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5718>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90118>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90118>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90118>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90118>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90118>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a674f0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a674f0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67e80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53bab68>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bafa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bafa0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53bafa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a905e0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a905e0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:55:50.180 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59782 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:55:50.846 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:50.850 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:50.877 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:59978 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:55:55.094 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:55:55.095 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:55:55.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60088 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:55:55.939 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60090 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:55:56.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:55:56.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:55:56.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60128 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:00.186 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:00.206 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:00.208 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:00.210 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:56:00.212 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:56:00.214 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:56:00.216 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:56:00.218 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:56:00.319 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:56:00.320 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:56:00.322 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:56:00.323 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:00.326 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:00.338 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:56:00.339 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:56:00.341 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:56:00.342 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:56:00.381 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:56:00.411 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:56:01.469 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:01.491 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:01.493 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:01.494 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:56:01.495 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb55274d8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb55274d8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb55274d8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb55274d8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab32c8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab32c8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab32c8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab32c8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ab32c8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411850>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411850>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54112f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411a48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411190>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a90b68>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a90b68>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:56:01.558 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60092 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:56:01.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60286 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:01.894 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60292 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:02.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:02.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:02.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60324 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:06.452 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:56:06.453 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:56:07.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60436 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:07.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60442 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:08.890 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:08.893 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:08.920 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60488 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:11.539 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:11.563 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:11.565 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:11.566 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:56:11.568 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:56:11.570 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:56:11.572 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:56:11.574 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:56:11.676 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:56:11.676 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:56:11.677 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:56:11.679 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:11.682 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:11.695 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:56:11.696 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:56:11.697 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:56:11.698 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:56:11.735 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:56:11.764 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:56:12.820 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:12.838 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:12.840 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:12.841 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:56:12.843 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3508>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ab3508>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ab3508>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3508>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b7d8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b7d8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b7d8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b7d8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b7d8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411fa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411fa0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411fa0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411f10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59418>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59418>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59418>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a59460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb546b880>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb546b880>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:56:12.912 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60402 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:56:13.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60624 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:13.913 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60628 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:14.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:14.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:14.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60660 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:17.806 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:56:17.808 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:56:19.878 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60780 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:19.943 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60784 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:20.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:20.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:20.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60822 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:22.961 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:22.989 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:22.991 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:22.992 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:56:22.994 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:56:22.996 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:56:22.997 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:56:22.998 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:56:23.119 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:56:23.119 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:56:23.121 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:56:23.122 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:23.125 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:23.137 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:56:23.138 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:56:23.140 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:56:23.141 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:56:23.179 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:56:23.207 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:56:24.245 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:56:24.247 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Request timed out after 1.0 second.
Traceback (most recent call last):

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 68, in get_mavlink_message
    async with session.get(request_url, timeout=request_timeout) as response:
               │       │   │                    └ 1.0
               │       │   └ 'http://localhost:6040/mavlink/vehicles/1/components/1/messages/HEARTBEAT'
               │       └ <function ClientSession.get at 0xb5797c88>
               └ <aiohttp.client.ClientSession object at 0xb4a186b8>
  File "/usr/local/lib/python3.9/site-packages/aiohttp/client.py", line 1117, in __aenter__
    self._resp = await self._coro
    │    │             │    └ <member '_coro' of '_BaseRequestContextManager' objects>
    │    │             └ <aiohttp.client._RequestContextManager object at 0xb4a97648>
    │    └ <member '_resp' of '_BaseRequestContextManager' objects>
    └ <aiohttp.client._RequestContextManager object at 0xb4a97648>
  File "/usr/local/lib/python3.9/site-packages/aiohttp/client.py", line 544, in _request
    await resp.start(conn)
          │    │     └ Connection<ConnectionKey(host='localhost', port=6040, is_ssl=False, ssl=None, proxy=None, proxy_auth=None, proxy_headers_hash...
          │    └ <function ClientResponse.start at 0xb58dcec8>
          └ <ClientResponse(http://localhost:6040/mavlink/vehicles/1/components/1/messages/HEARTBEAT) [None None]>
            None
  File "/usr/local/lib/python3.9/site-packages/aiohttp/client_reqrep.py", line 905, in start
    self._continue = None
    │    └ None
    └ <ClientResponse(http://localhost:6040/mavlink/vehicles/1/components/1/messages/HEARTBEAT) [None None]>
      None
  File "/usr/local/lib/python3.9/site-packages/aiohttp/helpers.py", line 656, in __exit__
    raise asyncio.TimeoutError from None
          │       └ <class 'asyncio.exceptions.TimeoutError'>
          └ <module 'asyncio' from '/usr/local/lib/python3.9/asyncio/__init__.py'>

asyncio.exceptions.TimeoutError


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3598>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ab3598>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ab3598>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ab3598>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b268>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b268>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b268>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b268>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b268>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411ad8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411ad8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411538>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411cd0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411d18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411d18>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411d18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb546bfb8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb546bfb8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 118, in get_updated_mavlink_message
    new_message = await self.get_mavlink_message(message_name, vehicle or self.system_id, component)
                        │    │                   │             │          │    │          └ 1
                        │    │                   │             │          │    └ 1
                        │    │                   │             │          └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                        │    │                   │             └ None
                        │    │                   └ 'HEARTBEAT'
                        │    └ <function MavlinkMessenger.get_mavlink_message at 0xb618eb68>
                        └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 77, in get_mavlink_message
    raise MavlinkMessageReceiveFail(f"Request timed out after {request_timeout} second.") from error
          └ <class 'commonwealth.mavlink_comm.exceptions.MavlinkMessageReceiveFail'>

commonwealth.mavlink_comm.exceptions.MavlinkMessageReceiveFail: Request timed out after 1.0 second.
2023-06-11 16:56:24.321 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60748 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:56:25.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60950 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:25.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60956 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:26.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:26.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:26.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:60986 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:29.247 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:56:29.249 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:56:31.878 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:32884 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:31.914 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:32890 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:32.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:32.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:32.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:32928 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:34.336 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:34.355 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:34.357 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:34.358 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:56:34.360 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:56:34.362 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:56:34.363 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:56:34.365 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:56:34.493 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:56:34.494 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:56:34.495 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:56:34.496 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:34.499 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:34.513 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:56:34.514 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:56:34.516 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:56:34.516 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:56:34.556 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:56:34.586 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:56:35.634 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:35.646 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:35.647 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:35.649 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:56:35.650 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb549cdc0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb549cdc0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb549cdc0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb549cdc0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac52f8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac52f8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac52f8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac52f8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac52f8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54114f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54114f0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb54114f0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54118e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54116e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c88>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ac5070>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ac5070>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:56:35.699 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:32812 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:56:36.750 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33316 - "GET / HTTP/1.1" 200
2023-06-11 16:56:36.785 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33322 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:56:36.794 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33324 - "GET /docs HTTP/1.1" 200
2023-06-11 16:56:36.805 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33326 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:56:36.814 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33328 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:56:36.824 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33330 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:56:36.834 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33332 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:56:36.846 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33334 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:56:37.866 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33406 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:37.894 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33410 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:38.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:38.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:38.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33446 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:40.629 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:56:40.630 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:56:44.448 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33576 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:44.477 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33582 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:44.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:44.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:44.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33612 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:45.740 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:45.760 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:45.762 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:45.764 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:56:45.766 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:56:45.768 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:56:45.770 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:56:45.772 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:56:45.887 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:56:45.888 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:56:45.891 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:56:45.892 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:45.895 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:45.908 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:56:45.909 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:56:45.911 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:56:45.912 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:56:45.953 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:56:45.981 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:56:47.043 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:47.066 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:47.068 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:47.070 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:56:47.072 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5452958>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5452958>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5452958>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5452958>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a909a0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a909a0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a909a0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a909a0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a909a0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411970>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411970>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9190>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9190>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9190>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f91d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411898>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a90bb0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a90bb0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:56:47.140 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33494 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:56:49.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33730 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:49.913 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33734 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:50.844 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:50.849 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:50.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33766 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:52.030 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:56:52.032 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:56:55.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33918 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:56:55.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33922 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:56:56.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:56.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:56.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33960 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:56:57.126 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:57.148 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:57.151 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:57.153 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:56:57.155 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:56:57.156 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:56:57.158 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:56:57.159 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:56:57.258 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:56:57.260 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:56:57.261 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:56:57.262 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:56:57.266 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:56:57.280 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:56:57.281 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:56:57.283 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:56:57.283 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:56:57.327 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:56:57.361 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:56:58.417 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:56:58.435 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:56:58.436 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:56:58.438 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:56:58.439 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5452b38>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5452b38>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5452b38>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5452b38>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc8b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc8b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc8b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc8b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc8b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411610>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411610>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c40>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c40>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c40>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c40>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411c40>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411d60>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411b20>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4accd60>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4accd60>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:56:58.506 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:33820 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:57:01.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34084 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:01.924 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34088 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:02.838 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:02.842 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:02.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34124 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:03.406 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:57:03.408 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:57:07.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34272 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:07.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34282 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:08.505 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:08.517 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:08.518 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:08.519 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:57:08.521 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:57:08.522 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:57:08.523 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:57:08.524 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:57:08.614 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:57:08.614 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:57:08.615 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:57:08.616 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:08.619 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:08.632 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:57:08.633 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:57:08.635 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:57:08.636 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:57:08.691 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:57:08.739 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:57:09.795 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:09.802 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:09.814 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:09.836 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:09.838 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:09.839 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:57:09.841 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a904d8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a904d8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a904d8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a904d8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18160>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18160>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18160>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18160>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18160>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411730>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411730>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54112f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54112f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54112f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54112f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54112f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411a48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a18508>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a18508>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:57:09.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34152 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:57:09.901 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34324 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:13.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34430 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:13.902 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34434 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:14.785 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:57:14.786 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:57:15.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:15.870 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:15.910 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34498 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:19.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34618 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:19.911 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:19.933 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34624 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:19.941 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:19.943 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:19.944 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:57:19.946 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:57:19.948 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:57:19.950 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:57:19.952 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:57:20.037 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:57:20.037 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:57:20.038 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:57:20.039 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:20.042 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:20.054 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:57:20.055 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:57:20.057 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:57:20.059 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:57:20.097 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:57:20.125 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:57:21.169 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:21.181 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:21.183 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:21.184 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:57:21.185 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5afe8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5afe8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5afe8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5afe8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90e08>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90e08>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90e08>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90e08>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a90e08>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9a00>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9a00>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9a00>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9cd0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9898>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9898>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9898>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9898>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9898>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9268>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a901d8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a901d8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:57:21.229 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34496 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:57:21.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:21.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:21.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34696 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:25.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34768 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:25.918 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34774 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:26.162 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:57:26.163 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:57:27.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:27.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:27.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34838 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:31.255 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:31.276 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:31.278 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:31.280 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:57:31.282 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:57:31.284 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:57:31.285 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:57:31.287 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:57:31.412 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:57:31.413 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:57:31.414 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:57:31.415 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:31.417 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:31.430 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:57:31.431 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:57:31.432 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:57:31.433 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:57:31.472 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:57:31.500 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:57:32.572 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34958 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:32.586 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:32.611 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:32.613 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:32.615 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:57:32.615 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5bf8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4ac5bf8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4ac5bf8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4ac5bf8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18730>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18730>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18730>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18730>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a18730>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411268>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411268>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5411b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411b68>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411b68>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411b68>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb549c310>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb549c310>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:57:32.660 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34816 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:57:32.666 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:34964 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:33.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:33.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:33.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35026 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:36.778 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35362 - "GET / HTTP/1.1" 200
2023-06-11 16:57:36.814 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35364 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:57:36.824 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35370 - "GET /docs HTTP/1.1" 200
2023-06-11 16:57:36.836 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35372 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:57:36.847 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35374 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:57:36.857 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35376 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:57:36.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35378 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:57:36.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35380 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:57:37.541 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:57:37.542 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:57:37.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35462 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:37.915 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35466 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:39.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:39.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:39.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35536 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:42.633 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:42.650 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:42.655 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:42.656 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:57:42.657 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:57:42.659 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:57:42.661 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:57:42.662 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:57:42.776 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:57:42.776 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:57:42.777 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:57:42.778 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:42.781 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:42.795 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:57:42.796 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:57:42.798 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:57:42.799 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:57:42.839 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:57:42.870 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:57:43.937 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35656 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:43.953 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:43.976 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:43.979 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:43.980 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:57:43.982 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a430>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a5a430>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a5a430>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a5a430>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad2f8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad2f8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad2f8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad2f8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad2f8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9100>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9100>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f99b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9f58>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f9ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ac5b38>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ac5b38>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:57:44.027 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35464 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:57:44.033 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35660 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:45.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:45.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:45.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35714 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:48.916 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:57:48.954 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:57:49.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35804 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:49.928 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35814 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:51.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:51.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:51.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35884 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:57:54.058 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:54.085 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:54.086 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:54.088 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:57:54.089 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:57:54.090 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:57:54.091 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:57:54.093 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:57:54.185 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:57:54.186 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:57:54.188 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:57:54.189 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:54.194 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:54.212 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:57:54.213 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:57:54.215 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:57:54.216 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:57:54.255 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:57:54.284 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:57:55.337 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:57:55.356 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:57:55.358 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:57:55.360 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:57:55.362 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a90fd0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a90fd0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a90fd0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a90fd0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5640>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5640>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5640>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5640>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4ac5640>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9658>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53f9658>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f9418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9970>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9970>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9970>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53f97c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9ad8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53f9ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53f94a8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4ac5478>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4ac5478>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:57:55.434 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:35808 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:57:55.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36006 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:57:55.902 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36010 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:57:57.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:57:57.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:57:57.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36056 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:00.329 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:58:00.330 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:58:01.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36164 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:01.896 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36168 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:03.850 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:03.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:03.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36242 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:05.418 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:05.436 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:05.437 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:05.438 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:58:05.439 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:58:05.441 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:58:05.442 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:58:05.443 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:58:05.541 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:58:05.542 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:58:05.543 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:58:05.543 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:05.546 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:05.559 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:58:05.560 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:58:05.561 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:58:05.562 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:58:05.601 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:58:05.627 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:58:06.682 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:06.700 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:06.702 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:06.703 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:58:06.704 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74850>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a74850>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a74850>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74850>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a906d0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a906d0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a906d0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a906d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a906d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54116e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5411e38>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54114f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54115c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54115c8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb54115c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5411388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a908b0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a908b0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:58:06.779 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36124 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:58:07.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36346 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:07.933 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36350 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:09.844 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:09.847 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:09.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36398 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:11.671 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:58:11.673 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:58:13.858 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36508 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:13.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36512 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:15.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:15.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:15.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36586 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:16.778 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:16.796 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:16.798 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:16.800 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:58:16.802 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:58:16.804 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:58:16.805 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:58:16.807 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:58:16.914 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:58:16.914 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:58:16.915 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:58:16.917 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:16.920 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:16.935 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:58:16.936 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:58:16.938 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:58:16.939 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:58:16.978 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:58:17.007 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:58:18.061 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:18.080 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:18.081 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:18.083 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:58:18.084 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5305e50>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5305e50>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5305e50>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5305e50>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54add00>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54add00>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54add00>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54add00>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54add00>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411a90>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5411a90>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a59190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59730>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59730>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59730>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a59148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb54119b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54ad730>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54ad730>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:58:18.153 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36470 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:58:19.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36688 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:19.898 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36692 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:21.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:21.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:21.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36742 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:23.050 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:58:23.053 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:58:25.857 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36858 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:25.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36862 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:27.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:27.960 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:27.975 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36918 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:28.142 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:28.153 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:28.154 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:28.155 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:58:28.156 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:58:28.157 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:58:28.157 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:58:28.158 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:58:28.239 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:58:28.241 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:58:28.241 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:58:28.242 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:28.245 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:28.257 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:58:28.258 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:58:28.260 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:58:28.261 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:58:28.299 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:58:28.327 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:58:29.373 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:29.386 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:29.387 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:29.388 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:58:29.389 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546ba30>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546ba30>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546ba30>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546ba30>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546ba30>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a592f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a592f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a592f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a59268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59898>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59898>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59898>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59898>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a59898>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a59610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a593d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a593d0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a593d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a598e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb546bb20>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb546bb20>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:58:29.432 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:36798 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:58:31.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37030 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:31.898 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37034 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:33.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:33.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:33.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37082 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:34.368 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:58:34.369 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:58:36.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37452 - "GET / HTTP/1.1" 200
2023-06-11 16:58:36.896 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37454 - "GET /register_service HTTP/1.1" 404
2023-06-11 16:58:36.912 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37460 - "GET /docs HTTP/1.1" 200
2023-06-11 16:58:36.923 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37462 - "GET /docs.json HTTP/1.1" 404
2023-06-11 16:58:36.932 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37464 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 16:58:36.942 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37466 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 16:58:36.953 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37468 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 16:58:36.964 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37470 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 16:58:37.853 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37546 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:37.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37550 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:39.451 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:39.473 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:39.475 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:39.476 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:58:39.478 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:58:39.479 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:58:39.481 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:58:39.482 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:58:39.606 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:58:39.608 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:58:39.609 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:58:39.612 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:39.615 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:39.628 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:58:39.629 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:58:39.630 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:58:39.631 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:58:39.672 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:58:39.701 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:58:40.752 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:40.763 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:40.772 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:40.797 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:40.798 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:40.799 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:58:40.800 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb548a970>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb548a970>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb548a970>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb548a970>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9fb8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9fb8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9fb8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9fb8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9fb8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67418>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67418>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67d60>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67c40>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a90>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67ec8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54c91d8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54c91d8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:58:40.844 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37118 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:58:40.855 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37624 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:43.871 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37716 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:43.904 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37720 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:45.745 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:58:45.747 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:58:46.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:46.876 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:46.932 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37800 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:49.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37890 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:49.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37894 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:50.846 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:50.863 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:50.865 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:50.866 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:58:50.868 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:58:50.870 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:58:50.871 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:58:50.873 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:58:50.995 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:58:50.997 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:58:50.999 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:58:51.000 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:51.003 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:51.018 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:58:51.020 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:58:51.022 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:58:51.022 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:58:51.067 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:58:51.101 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:58:52.162 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:58:52.185 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:58:52.186 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:58:52.187 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:58:52.189 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58170e8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58170e8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58170e8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58170e8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58170e8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a677c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a677c0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a677c0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a675c8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5817070>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5817070>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:58:52.251 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37798 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:58:52.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:52.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:52.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:37988 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:58:55.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38048 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:58:55.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38052 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:58:57.148 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:58:57.149 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:58:58.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:58:58.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:58:58.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38152 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:01.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38242 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:01.901 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38246 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:02.244 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:02.256 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:02.257 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:02.259 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:59:02.260 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:59:02.261 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:59:02.262 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:59:02.263 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:59:02.349 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:59:02.350 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:59:02.352 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:59:02.353 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:02.356 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:02.371 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:59:02.372 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:59:02.374 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:59:02.374 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:59:02.416 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:59:02.445 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:59:03.502 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:03.527 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:03.529 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:03.530 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:59:03.532 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb552f6d0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb552f6d0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb552f6d0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb552f6d0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362e08>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362e08>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362e08>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362e08>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362e08>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389928>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389928>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389df0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896a0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896a0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896a0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389538>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5362160>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5362160>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:59:03.594 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38112 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:59:04.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:04.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:04.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38342 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:07.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38402 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:07.915 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38408 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:08.485 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:59:08.486 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:59:10.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:10.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:10.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38510 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:13.580 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:13.598 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:13.600 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:13.601 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:59:13.603 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:59:13.604 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:59:13.606 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:59:13.607 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:59:13.723 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:59:13.724 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:59:13.725 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:59:13.726 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:13.729 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:13.742 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:59:13.743 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:59:13.745 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:59:13.746 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:59:13.786 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:59:13.815 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:59:14.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38602 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:14.900 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:14.918 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38606 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:14.927 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:14.933 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:14.935 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:59:14.936 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5305ca0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5305ca0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5305ca0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5305ca0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817508>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817508>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817508>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817508>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817508>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389148>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389148>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389d18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389460>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541f340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb58171f0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb58171f0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:59:14.996 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38448 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:59:16.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:16.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:16.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38688 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:19.861 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:59:19.863 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:59:20.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38792 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:20.937 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38794 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:22.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:22.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:22.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38864 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:25.016 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:25.045 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:25.046 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:25.048 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:59:25.049 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:59:25.053 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:59:25.055 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:59:25.056 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:59:25.179 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:59:25.180 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:59:25.181 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:59:25.183 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:25.186 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:25.199 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:59:25.201 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:59:25.203 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:59:25.204 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:59:25.243 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:59:25.272 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:59:26.320 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:26.338 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:26.340 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:26.341 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:59:26.343 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb53628f8>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb53628f8>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb53628f8>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb53628f8>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad580>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad580>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad580>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad580>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad580>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67028>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67028>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53891d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53891d8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53891d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53891d8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53891d8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389268>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548a250>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548a250>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:59:26.390 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38796 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:59:26.856 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38982 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:26.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:38986 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:28.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:28.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:28.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39042 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:31.314 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:59:31.315 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:59:32.866 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39150 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:32.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39152 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:34.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:34.863 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:34.892 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39226 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:36.400 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:36.420 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:36.428 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:36.429 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:59:36.431 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:59:36.433 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:59:36.435 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:59:36.437 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:59:36.564 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:59:36.565 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:59:36.565 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:59:36.566 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:36.569 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:36.582 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:59:36.583 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:59:36.584 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:59:36.585 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:59:36.624 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:59:36.652 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:59:37.704 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:37.729 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:37.730 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:37.732 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:59:37.734 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5305c70>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5305c70>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5305c70>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5305c70>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441b50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441b50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441b50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441b50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441b50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67e80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67e80>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67e80>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67808>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67808>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67808>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67928>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67b20>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67cd0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5441370>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5441370>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:59:37.814 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39118 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:59:38.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39346 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:38.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39348 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:40.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:40.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:40.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39394 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:42.698 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:59:42.700 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:59:44.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39500 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:44.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39504 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:46.842 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:46.845 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:46.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39572 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:47.807 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:47.824 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:47.827 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:47.828 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:59:47.829 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:59:47.831 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:59:47.832 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:59:47.834 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:59:47.972 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:59:47.973 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:59:47.974 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:59:47.975 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:47.978 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:47.992 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:59:47.993 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:59:47.995 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:59:47.996 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:59:48.034 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:59:48.065 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 16:59:49.121 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:49.143 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:49.144 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:49.146 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 16:59:49.148 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb552f898>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441628>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441628>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441628>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441628>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5441628>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389b20>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389b20>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389b20>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389808>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892f8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389ec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389340>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389460>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5441520>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5441520>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 16:59:49.202 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39460 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 16:59:50.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39684 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:50.908 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39688 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:52.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:52.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:52.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39742 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:54.110 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 16:59:54.113 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 16:59:56.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39850 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 16:59:56.915 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39854 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 16:59:58.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:58.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:58.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39922 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 16:59:59.200 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 16:59:59.213 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 16:59:59.214 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 16:59:59.215 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 16:59:59.216 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 16:59:59.217 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 16:59:59.218 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 16:59:59.219 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 16:59:59.304 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 16:59:59.305 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 16:59:59.306 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 16:59:59.307 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 16:59:59.311 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 16:59:59.324 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 16:59:59.325 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 16:59:59.327 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 16:59:59.328 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 16:59:59.370 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 16:59:59.400 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:00:00.455 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:00.476 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:00.479 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:00.481 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:00:00.483 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5441190>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5441190>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5441190>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5441190>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aa90>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aa90>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aa90>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aa90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548aa90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a672b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a673d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67388>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548ad00>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548ad00>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:00:00.560 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:39788 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:00:02.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40020 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:02.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40024 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:04.850 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:04.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:04.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40072 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:05.441 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:00:05.442 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:00:08.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40196 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:08.900 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40200 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:10.508 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:10.520 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:10.522 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:10.524 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:00:10.525 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:00:10.527 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:00:10.528 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:00:10.530 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:00:10.618 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:00:10.620 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:00:10.621 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:00:10.624 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:10.627 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:10.641 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:00:10.642 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:00:10.644 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:00:10.645 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:00:10.686 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:00:10.715 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:00:11.761 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:11.764 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:11.772 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:11.788 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:11.790 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:11.792 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:00:11.794 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb548a4f0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852868>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852868>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852868>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852868>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852868>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541f418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541f418>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541f418>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541fec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f3d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f3d0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f3d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f3d0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f3d0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5852898>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5852898>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:00:11.852 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40100 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:00:11.858 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40274 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:14.851 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40368 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:14.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40372 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:16.757 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:00:16.759 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:00:17.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:17.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:17.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40464 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:20.855 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40554 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:20.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40560 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:21.835 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:21.854 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:21.856 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:21.859 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:00:21.862 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:00:21.864 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:00:21.866 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:00:21.867 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:00:21.972 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:00:21.973 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:00:21.975 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:00:21.976 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:21.979 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:21.992 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:00:21.992 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:00:21.994 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:00:21.995 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:00:22.033 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:00:22.063 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:00:23.119 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:23.137 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:23.138 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:23.140 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:00:23.141 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54411c0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54411c0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54411c0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54411c0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a4a8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a4a8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a4a8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a4a8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a4a8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53898e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53898e0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53898e0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bf8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bf8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bf8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bf8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389bf8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389a00>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53897c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53897c0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53897c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548a928>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548a928>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:00:23.206 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40462 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:00:23.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:23.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:23.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40648 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:26.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40710 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:26.902 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40712 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:28.108 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:00:28.110 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:00:29.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:29.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:29.906 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40802 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:32.860 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40890 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:32.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40894 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:33.204 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:33.216 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:33.217 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:33.218 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:00:33.219 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:00:33.220 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:00:33.220 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:00:33.221 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:00:33.306 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:00:33.307 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:00:33.308 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:00:33.309 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:33.314 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:33.326 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:00:33.327 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:00:33.329 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:00:33.330 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:00:33.375 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:00:33.404 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:00:34.460 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:34.484 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:34.486 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:34.488 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:00:34.490 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5362fa0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5362fa0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5362fa0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5362fa0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58522b0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58522b0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58522b0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58522b0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb58522b0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389610>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389610>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53892b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53896e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5852958>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5852958>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:00:34.534 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:40776 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:00:35.839 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:35.843 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:35.860 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41118 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:36.826 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41280 - "GET / HTTP/1.1" 200
2023-06-11 17:00:36.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41286 - "GET /register_service HTTP/1.1" 404
2023-06-11 17:00:36.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41290 - "GET /docs HTTP/1.1" 200
2023-06-11 17:00:36.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41294 - "GET /docs.json HTTP/1.1" 404
2023-06-11 17:00:36.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41296 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 17:00:36.920 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41298 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 17:00:36.933 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41300 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 17:00:36.944 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41302 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 17:00:38.862 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41396 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:38.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41400 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:39.449 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:00:39.450 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:00:41.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:41.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:41.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41498 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:44.553 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:44.571 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:44.573 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:44.575 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:00:44.577 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:00:44.579 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:00:44.581 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:00:44.583 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:00:44.707 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:00:44.709 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:00:44.710 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:00:44.711 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:44.714 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:44.728 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:00:44.729 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:00:44.731 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:00:44.731 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:00:44.771 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:00:44.800 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:00:45.854 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41590 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:45.864 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:45.883 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:45.885 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:45.886 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:00:45.887 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb546b760>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb546b760>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb546b760>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb546b760>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546bf10>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546bf10>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546bf10>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546bf10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546bf10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389190>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389190>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389d18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389388>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389388>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53893d0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389730>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389850>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb546b268>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb546b268>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:00:45.929 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41440 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:00:45.935 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41594 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:47.848 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:47.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:47.874 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41674 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:50.844 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:00:50.845 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:00:51.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41764 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:51.926 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41768 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:53.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:53.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:53.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41834 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:00:55.972 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:55.992 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:55.993 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:55.996 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:00:55.997 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:00:55.999 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:00:56.001 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:00:56.002 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:00:56.136 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:00:56.137 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:00:56.138 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:00:56.140 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:56.143 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:56.157 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:00:56.159 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:00:56.161 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:00:56.162 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:00:56.207 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:00:56.237 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:00:57.279 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:00:57.300 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:00:57.301 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:00:57.303 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:00:57.304 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5362b08>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5362b08>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5362b08>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5362b08>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b20>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b20>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b20>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b20>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b20>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53899b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53899b8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53899b8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389778>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389778>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389778>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389580>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389c40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54ad820>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54ad820>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:00:57.352 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41766 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:00:57.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41958 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:00:57.898 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:41960 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:00:59.844 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:00:59.847 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:00:59.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42010 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:02.287 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:01:02.288 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:01:03.861 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42118 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:03.897 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42120 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:05.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:05.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:05.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42190 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:07.382 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:07.399 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:07.400 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:07.402 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:01:07.403 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:01:07.405 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:01:07.406 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:01:07.408 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:01:07.516 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:01:07.517 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:01:07.518 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:01:07.519 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:07.522 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:07.537 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:01:07.538 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:01:07.540 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:01:07.541 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:01:07.582 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:01:07.611 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:01:08.666 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:08.695 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:08.702 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:08.703 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:01:08.705 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4acc2b0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4acc2b0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4acc2b0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4acc2b0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acccd0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acccd0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acccd0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acccd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acccd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67a48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67a48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67f10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672b0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672b0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672b0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a672b0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a670b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67778>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb580cf10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4acc4f0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4acc4f0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:01:08.777 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42086 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:01:09.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42306 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:09.931 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42308 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:11.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:11.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:11.892 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42344 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:13.657 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:01:13.658 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:01:15.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42460 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:15.913 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42466 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:17.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:17.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:17.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42522 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:18.755 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:18.770 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:18.772 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:18.773 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:01:18.774 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:01:18.776 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:01:18.777 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:01:18.779 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:01:18.881 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:01:18.881 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:01:18.884 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:01:18.885 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:18.887 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:18.901 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:01:18.901 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:01:18.903 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:01:18.904 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:01:18.945 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:01:18.975 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:01:20.032 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:20.057 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:20.060 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:20.061 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:01:20.063 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5509e38>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5509e38>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5509e38>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5509e38>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817d78>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817d78>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817d78>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817d78>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817d78>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539fe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539fe80>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb539fe80>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539f388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f340>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f340>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f340>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb539f268>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb539f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb539fe38>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5817340>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5817340>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:01:20.140 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42422 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:01:21.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42636 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:21.911 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42638 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:23.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:23.868 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:23.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42692 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:25.021 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:01:25.023 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:01:27.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42802 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:27.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42806 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:29.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:29.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:29.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42866 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:30.108 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:30.120 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:30.121 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:30.122 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:01:30.122 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:01:30.123 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:01:30.124 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:01:30.125 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:01:30.209 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:01:30.210 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:01:30.211 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:01:30.212 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:30.214 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:30.227 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:01:30.228 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:01:30.229 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:01:30.230 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:01:30.271 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:01:30.301 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:01:31.360 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:31.381 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:31.383 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:31.384 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:01:31.385 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5441688>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5441688>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5441688>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5441688>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b50>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b50>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b50>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54c9b50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67850>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67850>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a674a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a676a0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fdf0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67bf8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54c9a78>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54c9a78>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:01:31.444 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42742 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:01:33.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42980 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:33.913 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:42986 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:35.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:35.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:35.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43108 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:36.346 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:01:36.348 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:01:39.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43218 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:39.897 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43222 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:41.446 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:41.469 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:41.471 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:41.472 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:01:41.473 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:01:41.474 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:01:41.475 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:01:41.477 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:01:41.590 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:01:41.591 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:01:41.592 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:01:41.593 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:41.596 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:41.609 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:01:41.610 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:01:41.611 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:01:41.612 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:01:41.657 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:01:41.686 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:01:42.740 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:42.749 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:42.756 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:42.777 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:42.779 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:42.781 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:01:42.782 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad190>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54ad190>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54ad190>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad190>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305df0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305df0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305df0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305df0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5305df0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541ff58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541ff58>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb541ff58>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541f418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb541fe38>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb541f340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389610>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb541ff10>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5305fe8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5305fe8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:01:42.852 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43132 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:01:42.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43292 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:45.866 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43392 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:45.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43396 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:47.732 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:01:47.735 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:01:48.864 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:48.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:48.909 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43484 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:51.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43572 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:51.902 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43576 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:52.841 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:52.860 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:52.861 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:52.863 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:01:52.865 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:01:52.867 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:01:52.869 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:01:52.870 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:01:52.976 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:01:52.977 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:01:52.979 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:01:52.980 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:52.983 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:52.996 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:01:52.998 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:01:53.000 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:01:53.000 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:01:53.046 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:01:53.076 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:01:54.125 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:01:54.137 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:01:54.138 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:01:54.139 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:01:54.139 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb546b838>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb546b838>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb546b838>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb546b838>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362790>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362790>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362790>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362790>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5362790>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389340>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389340>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389340>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53898e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389a48>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389580>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389580>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389970>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5362328>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5362328>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:01:54.180 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43482 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:01:54.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:01:54.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:01:54.890 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43676 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:01:57.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43740 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:01:57.912 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43744 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:01:59.121 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:01:59.122 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:02:00.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:00.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:00.891 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43832 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:03.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43914 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:03.914 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43918 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:04.230 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:04.252 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:04.253 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:04.255 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:02:04.256 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:02:04.258 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:02:04.259 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:02:04.261 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:02:04.359 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:02:04.360 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:02:04.361 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:02:04.363 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:04.365 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:04.378 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:02:04.378 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:02:04.380 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:02:04.381 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:02:04.424 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:02:04.455 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:02:05.514 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:05.537 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:05.539 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:05.540 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:02:05.542 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5362c28>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5362c28>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5362c28>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5362c28>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb80>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54adb80>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389658>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389658>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53894a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53894a8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53894a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53894a8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53894a8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389da8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389c88>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389028>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54ad730>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54ad730>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:02:05.612 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:43800 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:02:06.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:06.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:06.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44012 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:09.876 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44076 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:09.905 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44078 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:10.496 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:02:10.497 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:02:12.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:12.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:12.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44182 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:15.577 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:15.590 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:15.591 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:15.592 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:02:15.593 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:02:15.594 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:02:15.595 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:02:15.596 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:02:15.729 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:02:15.731 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:02:15.733 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:02:15.734 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:15.738 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:15.756 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:02:15.757 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:02:15.759 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:02:15.760 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:02:15.801 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:02:15.832 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:02:16.909 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44278 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:16.931 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:16.956 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:16.957 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:16.958 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:02:16.959 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5852610>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5852610>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5852610>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5852610>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad238>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad238>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad238>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad238>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb54ad238>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67610>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67610>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67610>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67e38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67100>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67100>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67100>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67898>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67d18>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb54ad478>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb54ad478>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:02:17.000 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44120 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:02:17.006 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44282 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:18.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:18.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:18.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44360 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:21.881 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:02:21.883 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:02:22.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44450 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:22.907 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44454 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:24.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:24.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:24.879 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44524 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:26.985 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:27.000 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:27.001 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:27.003 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:02:27.004 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:02:27.005 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:02:27.006 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:02:27.007 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:02:27.122 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:02:27.123 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:02:27.123 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:02:27.124 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:27.127 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:27.140 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:02:27.141 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:02:27.143 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:02:27.144 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:02:27.184 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:02:27.212 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:02:28.269 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:28.291 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:28.293 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:28.294 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:02:28.296 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4acca60>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4acca60>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4acca60>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4acca60>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548ae38>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548ae38>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548ae38>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548ae38>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548ae38>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67148>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67148>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67148>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67c40>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67fa0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67970>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb53059d0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb53059d0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:02:28.359 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44452 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:02:28.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44648 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:28.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44650 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:30.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:30.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:30.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44692 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:33.260 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:02:33.275 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:02:34.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44812 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:34.922 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44814 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:36.774 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45150 - "GET / HTTP/1.1" 200
2023-06-11 17:02:36.815 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45152 - "GET /register_service HTTP/1.1" 404
2023-06-11 17:02:36.827 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45154 - "GET /docs HTTP/1.1" 200
2023-06-11 17:02:36.841 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45160 - "GET /docs.json HTTP/1.1" 404
2023-06-11 17:02:36.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:36.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:36.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45164 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 17:02:36.875 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45162 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:36.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45166 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 17:02:36.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45168 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 17:02:36.908 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45170 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 17:02:38.352 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:38.364 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:38.365 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:38.366 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:02:38.367 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:02:38.368 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:02:38.369 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:02:38.370 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:02:38.453 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:02:38.454 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:02:38.456 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:02:38.457 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:38.460 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:38.482 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:02:38.484 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:02:38.487 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:02:38.488 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:02:38.552 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:02:38.585 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:02:39.644 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:39.663 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:39.665 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:39.667 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:02:39.669 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb549ccd0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb549ccd0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb549ccd0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb549ccd0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53625f8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53625f8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53625f8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53625f8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53625f8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389a00>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389a00>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389a00>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389418>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389f10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389f10>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389f10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389f10>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389f10>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53896e8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389a90>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5362d00>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5362d00>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:02:39.740 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:44772 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:02:40.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45344 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:40.892 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45346 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:42.840 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:42.843 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:42.858 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45392 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:44.631 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:02:44.632 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:02:46.856 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45504 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:46.887 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45506 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:48.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:48.869 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:48.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45572 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:49.734 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:49.752 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:49.754 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:49.756 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:02:49.757 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:02:49.759 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:02:49.761 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:02:49.763 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:02:49.882 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:02:49.883 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:02:49.885 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:02:49.886 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:49.889 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:49.901 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:02:49.902 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:02:49.904 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:02:49.906 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:02:49.945 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:02:49.974 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:02:51.026 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:02:51.048 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:02:51.050 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:02:51.051 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:02:51.053 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74b68>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a74b68>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a74b68>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74b68>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c988>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c988>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c988>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c988>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549c988>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389f58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389f58>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389f58>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53897c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389028>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389028>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389028>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389bf8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389100>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389100>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53899b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb549c9b8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb549c9b8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:02:51.135 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45438 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:02:52.867 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45670 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:52.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45672 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:02:54.850 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:02:54.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:02:54.869 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45722 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:02:56.022 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:02:56.024 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:02:58.858 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45844 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:02:58.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45846 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:00.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:00.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:00.880 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45912 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:01.117 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:01.141 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:01.144 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:01.145 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:03:01.147 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:03:01.148 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:03:01.150 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:03:01.152 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:03:01.249 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:03:01.250 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:03:01.251 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:03:01.252 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:01.255 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:01.268 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:03:01.269 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:03:01.271 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:03:01.271 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:03:01.308 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:03:01.338 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:03:02.393 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:02.418 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:02.419 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:02.421 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:03:02.422 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5509e20>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5509e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5509e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5509e20>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53623a0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53623a0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53623a0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53623a0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb53623a0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67ad8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67ad8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67850>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67da8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a677c0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a674f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5362fd0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5362fd0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:03:02.484 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:45778 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:03:04.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46016 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:04.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46018 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:06.842 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:06.846 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:06.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46064 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:07.388 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:03:07.389 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:03:10.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46188 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:10.897 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46192 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:12.479 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:12.501 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:12.504 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:12.505 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:03:12.507 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:03:12.508 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:03:12.513 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:03:12.516 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:03:12.625 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:03:12.627 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:03:12.629 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:03:12.630 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:12.633 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:12.648 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:03:12.650 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:03:12.652 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:03:12.653 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:03:12.699 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:03:12.730 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:03:13.793 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:13.801 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:13.808 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:13.831 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:13.832 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:13.834 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:03:13.835 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb548aa00>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb548aa00>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb548aa00>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb548aa00>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817838>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817838>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817838>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817838>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5817838>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53dbe80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53dbe80>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb53dbe80>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53404a8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340ad8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340ad8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340ad8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5340190>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340460>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340460>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53dbda8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a742b0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a742b0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:03:13.893 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46100 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:03:13.907 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46266 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:16.850 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46358 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:16.877 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46360 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:18.782 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:03:18.783 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:03:19.848 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:19.854 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:19.898 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46436 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:22.870 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46532 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:22.909 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46534 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:23.911 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:23.934 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:23.935 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:23.937 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:03:23.939 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:03:23.940 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:03:23.942 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:03:23.944 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:03:24.067 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:03:24.068 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:03:24.069 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:03:24.071 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:24.076 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:24.089 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:03:24.091 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:03:24.092 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:03:24.093 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:03:24.130 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:03:24.160 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:03:25.274 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:25.297 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:25.299 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:25.301 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:03:25.302 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4accf58>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4accf58>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4accf58>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4accf58>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc880>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc880>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc880>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc880>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4acc880>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5446070>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5446070>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5446070>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547fbb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fc88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fc88>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fc88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fc88>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fc88>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547ff58>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fd18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fd18>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fd18>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446f58>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4accdd8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4accdd8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:03:25.363 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46434 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:03:25.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:25.858 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:25.873 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46632 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:28.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46700 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:28.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46702 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:30.264 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:03:30.268 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:03:31.852 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:31.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:31.882 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46790 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:34.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46890 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:34.904 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46892 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:35.356 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:35.367 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:35.368 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:35.369 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:03:35.370 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:03:35.371 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:03:35.372 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:03:35.373 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:03:35.469 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:03:35.470 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:03:35.472 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:03:35.473 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:35.475 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:35.489 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:03:35.490 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:03:35.491 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:03:35.492 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:03:35.530 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:03:35.563 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:03:36.615 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:36.635 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:36.638 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:36.640 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:03:36.642 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74868>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb4a74868>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb4a74868>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb4a74868>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b988>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b988>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b988>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b988>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb546b988>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389970>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389970>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547f2f8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547f220>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb547f1d8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fe38>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb547fe38>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5389778>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb546bd00>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb546bd00>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:03:36.711 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:46750 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:03:36.944 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47238 - "GET / HTTP/1.1" 200
2023-06-11 17:03:36.979 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47240 - "GET /register_service HTTP/1.1" 404
2023-06-11 17:03:36.990 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47242 - "GET /docs HTTP/1.1" 200
2023-06-11 17:03:37.001 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47244 - "GET /docs.json HTTP/1.1" 404
2023-06-11 17:03:37.011 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47246 - "GET /openapi.json HTTP/1.1" 200
2023-06-11 17:03:37.022 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47248 - "GET /v1.0/docs HTTP/1.1" 200
2023-06-11 17:03:37.033 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47250 - "GET /v1.0/openapi.json HTTP/1.1" 200
2023-06-11 17:03:37.048 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47252 - "GET /swagger.json HTTP/1.1" 404
2023-06-11 17:03:37.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:37.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:37.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47318 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:40.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47392 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:40.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47394 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:41.612 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:03:41.615 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:03:43.857 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:43.861 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:43.892 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47496 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:46.717 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:46.741 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:46.744 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:46.745 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:03:46.747 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:03:46.749 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:03:46.750 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:03:46.753 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:03:46.832 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:03:46.833 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:03:46.834 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:03:46.837 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:46.841 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:46.854 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:03:46.855 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:03:46.857 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:03:46.857 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:03:46.895 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:03:46.925 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:03:47.990 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47588 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:48.008 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:48.038 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:48.039 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:48.041 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:03:48.042 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5452850>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5452850>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5452850>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5452850>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a7a8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a7a8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a7a8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a7a8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb548a7a8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67658>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67658>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a676a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67ec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67ec8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67ec8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67ec8>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67ec8>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67a00>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67388>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67388>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67340>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb548a3e8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb548a3e8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:03:48.093 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47434 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:03:48.099 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47590 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:49.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:49.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:49.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47664 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:52.979 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:03:52.986 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:03:53.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47752 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:53.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47756 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:03:55.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:55.859 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:55.885 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47826 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:03:58.084 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:58.098 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:58.099 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:58.101 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:03:58.102 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:03:58.104 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:03:58.106 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:03:58.108 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:03:58.239 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:03:58.240 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:03:58.242 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:03:58.243 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:03:58.251 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:03:58.264 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:03:58.265 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:03:58.266 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:03:58.267 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:03:58.306 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:03:58.335 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:03:59.390 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:03:59.409 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:03:59.411 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:03:59.412 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:03:59.414 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb549cb80>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb549cb80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb549cb80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb549cb80>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cec8>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cec8>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cec8>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cec8>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb549cec8>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5340f10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5340f10>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5340f10>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb53408e0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340bb0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340bb0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340bb0>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5340bb0>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5340070>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53404f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53404f0>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb53404f0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a67268>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb534d4a8>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb534d4a8>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:03:59.477 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47754 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:03:59.859 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47950 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:03:59.878 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:47952 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:04:01.841 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:01.845 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:01.872 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48008 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:04:04.385 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:04:04.386 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:04:05.864 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48112 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:04:05.903 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48114 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:04:07.862 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:07.865 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:07.889 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48172 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:04:09.487 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:04:09.505 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:04:09.506 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:04:09.508 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:04:09.510 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:04:09.512 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:04:09.513 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:04:09.515 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:04:09.626 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:04:09.626 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:04:09.628 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:04:09.628 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:09.632 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:09.645 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:04:09.646 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:04:09.648 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:04:09.649 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:04:09.688 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:04:09.720 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:04:10.782 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:04:10.805 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:04:10.807 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:04:10.808 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:04:10.810 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb5305af0>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb5305af0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb5305af0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb5305af0>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74b80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74b80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74b80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74b80>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb4a74b80>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67970>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb4a67970>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a676a0>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67538>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67538>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67538>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a67538>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb4a67ad8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb4a675c8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb4a679b8>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb4a74f88>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb4a74f88>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:04:10.896 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48076 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:04:11.863 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48278 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:04:11.894 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48280 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:04:13.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:13.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:13.888 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48322 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:04:15.769 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:04:15.771 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:04:17.853 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48442 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:04:17.881 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48444 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:04:19.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:19.860 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:19.886 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48504 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:04:20.876 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:04:20.898 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:04:20.899 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:04:20.901 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:04:20.903 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:04:20.905 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:04:20.907 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:04:20.909 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:04:21.003 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:04:21.004 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:04:21.007 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:04:21.009 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:21.012 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:21.026 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:04:21.027 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:04:21.030 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:04:21.031 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:04:21.070 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:04:21.103 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:04:22.153 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:04:22.167 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:04:22.168 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:04:22.169 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:04:22.170 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54c9190>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54c9190>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54c9190>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54c9190>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5452fa0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5452fa0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5452fa0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5452fa0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5452fa0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389f10>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389f10>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5389f10>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389970>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389658>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389658>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389658>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389658>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5389778>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389c88>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5389c88>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb53898e0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb5452628>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb5452628>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:04:22.217 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48410 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:04:23.849 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48624 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:04:23.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48626 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:04:25.851 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:25.855 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:25.884 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48672 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:04:27.152 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:04:27.154 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
2023-06-11 17:04:29.865 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48790 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:04:29.899 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48792 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:04:31.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:31.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:31.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48858 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:04:32.248 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:04:32.268 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:04:32.271 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:04:32.272 | WARNING  | ArduPilotManager:kill_ardupilot:438 - Could not disarm vehicle: Did not receive an updated HEARTBEAT before timeout.. Proceeding with kill.
2023-06-11 17:04:32.274 | INFO     | ArduPilotManager:kill_ardupilot:443 - Terminating Ardupilot subprocess.
2023-06-11 17:04:32.276 | INFO     | ArduPilotManager:terminate_ardupilot_subprocess:414 - Ardupilot subprocess terminated.
2023-06-11 17:04:32.277 | INFO     | ArduPilotManager:kill_ardupilot:445 - Ardupilot subprocess terminated.
2023-06-11 17:04:32.279 | INFO     | ArduPilotManager:kill_ardupilot:446 - Pruning Ardupilot's system processes.
2023-06-11 17:04:32.369 | INFO     | ArduPilotManager:kill_ardupilot:448 - Ardupilot's system processes pruned.
2023-06-11 17:04:32.370 | INFO     | ArduPilotManager:kill_ardupilot:450 - Stopping Mavlink manager.
2023-06-11 17:04:32.372 | INFO     | ArduPilotManager:kill_ardupilot:452 - Mavlink manager stopped.
2023-06-11 17:04:32.373 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:32.377 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:32.390 | WARNING  | ArduPilotManager:start_ardupilot:462 - More than a single board detected: [FlightController(name='Navigator', manufacturer='Blue Robotics', platform=<Platform.Navigator: 'navigator'>, path=None, flags=[]), FlightController(name='SITL', manufacturer='ArduPilot Team', platform=<Platform.SITL: 'SITL_arm_linux_gnueabihf'>, path=None, flags=[])]
2023-06-11 17:04:32.391 | DEBUG    | ArduPilotManager:get_board_to_be_used:377 - Preferred flight-controller is Pixhawk1.
2023-06-11 17:04:32.392 | DEBUG    | ArduPilotManager:get_board_to_be_used:382 - Flight-controller Pixhawk1 not connected.
2023-06-11 17:04:32.393 | INFO     | ArduPilotManager:start_ardupilot:465 - Using Navigator flight-controller.
2023-06-11 17:04:32.429 | INFO     | ArduPilotManager:start_linux_board:223 - Using command line: '/root/.config/ardupilot-manager/firmware/ardupilot_navigator -A udp:127.0.0.1:8852 --log-directory /root/.config/ardupilot-manager/firmware/logs/ --storage-directory /root/.config/ardupilot-manager/firmware/storage/ -C /dev/ttyS0 -B /dev/ttyAMA1 -E /dev/ttyAMA2 -F /dev/ttyAMA3'
2023-06-11 17:04:32.459 | DEBUG    | mavlink_proxy.AbstractRouter:start:90 - Calling router using following command: '/usr/bin/mavlink-routerd 127.0.0.1:8852 0.0.0.0:14660 --endpoint 127.0.0.1:14000 --endpoint 192.168.2.1:14551 --endpoint 192.168.2.1:14550 --tcp-port 5777 -l /root/.config/ardupilot-manager/logs'.
2023-06-11 17:04:33.520 | WARNING  | commonwealth.mavlink_comm.MavlinkComm:get_updated_mavlink_message:123 - no new messages after 5.0 seconds, triggering system-id detection
2023-06-11 17:04:33.541 | DEBUG    | commonwealth.mavlink_comm.MavlinkComm:get_most_recent_vehicle_id:102 - 1 (detected)
2023-06-11 17:04:33.542 | INFO     | commonwealth.mavlink_comm.MavlinkComm:set_system_id:28 - system_id set to: 1
2023-06-11 17:04:33.545 | ERROR    | commonwealth.utils.apis:custom_route_handler:36 - Unhandled service exception.
2023-06-11 17:04:33.546 | ERROR    | commonwealth.utils.apis:custom_route_handler:37 - Did not receive an updated HEARTBEAT before timeout.
Traceback (most recent call last):

  File "/home/pi/services/ardupilot_manager/main.py", line 244, in <module>
    loop.run_until_complete(server.serve())
    │    │                  │      └ <function Server.serve at 0xb5d23100>
    │    │                  └ <uvicorn.server.Server object at 0xb5509aa8>
    │    └ <function BaseEventLoop.run_until_complete at 0xb6465da8>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0xb6465d60>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0xb6467b20>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/usr/local/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
    │      └ <function Handle._run at 0xb64ad808>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad340>()>
  File "/usr/local/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0xb54ad340>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0xb54ad340>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0xb54ad340>()>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/protocols/http/h11_impl.py", line 396, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0xb53140b8>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852b80>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0xb5314100>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852b80>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852b80>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/proxy_headers.py", line 45, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852b80>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0xb5852b80>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0xb52e9028>
  File "/usr/local/lib/python3.9/site-packages/uvicorn-0.13.4-py3.9.egg/uvicorn/middleware/message_logger.py", line 61, in __call__
    await self.app(scope, inner_receive, inner_send)
          │    │   │      │              └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5446028>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb560c2c8>
          └ <uvicorn.middleware.message_logger.MessageLoggerMiddleware object at 0xb5509b38>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5446028>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function MessageLoggerMiddleware.__call__.<locals>.inner_send at 0xb5446028>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
          └ <fastapi.applications.FastAPI object at 0xb560c2c8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb5446a00>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb560c340>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446e80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb560c310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb560c3d0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446e80>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Mount.handle at 0xb5f08808>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 376, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446e80>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.applications.FastAPI object at 0xb5509508>
          └ <starlette.routing.Mount object at 0xb55094c0>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/applications.py", line 199, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446e80>
                           │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/applications.py", line 111, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446e80>
          │    │                │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
          └ <fastapi.applications.FastAPI object at 0xb5509508>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0xb54469b8>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0xb5509400>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0xb5509310>
          └ <starlette.exceptions.ExceptionMiddleware object at 0xb5509430>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 566, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446a90>
          │     │      │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0xb5f084f0>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 227, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0xb5446a90>
          │    │   │      └ <function MessageLoggerMiddleware.__call__.<locals>.inner_receive at 0xb5446730>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.1'}, 'http_version': '1.0', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0xb54f0148>
          └ <commonwealth.utils.apis.GenericErrorHandlingRoute object at 0xb5531ce8>
  File "/usr/local/lib/python3.9/site-packages/starlette-0.13.6-py3.9.egg/starlette/routing.py", line 41, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0xb58520a0>
                     └ <function GenericErrorHandlingRoute.get_route_handler.<locals>.custom_route_handler at 0xb54f0100>
> File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/utils/apis.py", line 31, in custom_route_handler
    return await original_route_handler(request)
                 │                      └ <starlette.requests.Request object at 0xb58520a0>
                 └ <function get_request_handler.<locals>.app at 0xb54f0028>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 201, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0xb5f08ec8>
  File "/usr/local/lib/python3.9/site-packages/fastapi-0.63.0-py3.9.egg/fastapi/routing.py", line 148, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function get_vehicle_type at 0xb555afa0>
                 └ <fastapi.dependencies.models.Dependant object at 0xb5531e50>

  File "/home/pi/services/ardupilot_manager/main.py", line 124, in get_vehicle_type
    return await autopilot.vehicle_manager.get_vehicle_type()
                 │         │               └ <function VehicleManager.get_vehicle_type at 0xb618edf0>
                 │         └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
                 └ <ArduPilotManager.ArduPilotManager object at 0xb55eea48>

  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/VehicleManager.py", line 75, in get_vehicle_type
    heartbeat_message = await self.mavlink2rest.get_updated_mavlink_message("HEARTBEAT")
                              │    │            └ <function MavlinkMessenger.get_updated_mavlink_message at 0xb618ebb0>
                              │    └ <commonwealth.mavlink_comm.MavlinkComm.MavlinkMessenger object at 0xb55eef88>
                              └ <commonwealth.mavlink_comm.VehicleManager.VehicleManager object at 0xb55eec58>
  File "/usr/local/lib/python3.9/site-packages/commonwealth-0.1.0-py3.9.egg/commonwealth/mavlink_comm/MavlinkComm.py", line 125, in get_updated_mavlink_message
    raise FetchUpdatedMessageFail(f"Did not receive an updated {message_name} before timeout.")
          └ <class 'commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail'>

commonwealth.mavlink_comm.exceptions.FetchUpdatedMessageFail: Did not receive an updated HEARTBEAT before timeout.
2023-06-11 17:04:33.614 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48734 - "GET /v1.0/vehicle_type HTTP/1.0" 500
2023-06-11 17:04:35.868 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48970 - "GET /v1.0/board HTTP/1.0" 200
2023-06-11 17:04:35.895 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:48972 - "GET /v1.0/firmware_info HTTP/1.0" 200
2023-06-11 17:04:37.853 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:50 - Trying to detect Linux board.
2023-06-11 17:04:37.856 | DEBUG    | flight_controller_detector.Detector:detect_linux_board:52 - Navigator R5 detected.
2023-06-11 17:04:37.883 | INFO     | uvicorn.protocols.http.h11_impl:send:461 - 127.0.0.1:49018 - "GET /v1.0/available_boards HTTP/1.0" 200
2023-06-11 17:04:38.509 | DEBUG    | ArduPilotManager:auto_restart_ardupilot:94 - Restarting ardupilot...
2023-06-11 17:04:38.510 | INFO     | ArduPilotManager:kill_ardupilot:434 - Disarming vehicle.
